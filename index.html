<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consola de Control - Estilo Apple (Móvil)</title>
    <!-- Enlace a Tailwind CSS CDN para estilos rápidos y responsivos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuración personalizada de Tailwind CSS para la fuente y colores -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'], // Define la fuente Inter
                    },
                    colors: {
                        'fuchsia-exacto': '#E6007A', // Color fucsia principal de la marca
                        'glass-dark': 'rgba(28, 28, 30, 0.75)', // Fondo oscuro semitransparente para el efecto de cristal
                        'text-dark': '#333333', // Color de texto oscuro para fondos claros
                        'text-light-contrast': '#E0E0E0', // Color de texto claro para elementos oscuros
                        'color-blanco': '#FFFFFF', // Blanco puro para texto y elementos
                        'panel-border': 'rgba(255, 255, 255, 0.1)', // Borde sutil para paneles de cristal
                        'dock-border': 'rgba(255, 255, 255, 0.18)', // Borde más pronunciado para el dock
                        'overlay-dark': 'rgba(0, 0, 0, 0.9)', /* Fondo oscuro para el overlay, AÚN MÁS OPACo */
                    }
                }
            }
        }
    </script>
    <!-- Enlace a Google Fonts para importar la fuente Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos base para el cuerpo de la página (Mobile-First para responsividad) */
        body {
            font-family: 'Inter', sans-serif; /* Aplica la fuente Inter */
            -webkit-font-smoothing: antialiased; /* Suavizado de fuente para WebKit */
            -moz-osx-font-smoothing: grayscale; /* Suavizado de fuente para Firefox */
            background-color: #FFFFFF; /* Fondo blanco puro y limpio */
            background-image: none; /* Asegura que no haya degradados ni imágenes de fondo */
            color: var(--tw-colors-text-dark); /* Color de texto oscuro por defecto */
            display: flex; /* Usa flexbox para centrar y organizar el contenido */
            flex-direction: column; /* Apila los elementos verticalmente */
            min-height: 100vh; /* Asegura que el cuerpo ocupe al menos el 100% de la altura de la ventana */
            align-items: center; /* Centra los elementos horizontalmente */
            justify-content: flex-start; /* Alinea los elementos al inicio del contenedor flex */
            padding: 0.5rem; /* Padding más pequeño para dispositivos móviles */
            overflow-x: hidden; /* Evita el scroll horizontal general del body */
            overflow-y: auto; /* Permite el scroll vertical en el body si el contenido es demasiado largo */
            user-select: none; /* Deshabilita la selección de texto en toda la página para una experiencia más de aplicación */
            -webkit-user-select: none; /* Para Safari */
            -moz-user-select: none; /* Para Firefox */
            -ms-user-select: none; /* Para IE/Edge */
        }

        /* Ajustes de padding para pantallas medianas y grandes */
        @media (min-width: 768px) { /* md breakpoint de Tailwind */
            body {
                padding: 1rem; /* Padding estándar para tabletas y PC */
            }
        }

        /* Estilos personalizados para la barra de desplazamiento (webkit) */
        ::-webkit-scrollbar {
            width: 8px; /* Ancho de la barra de desplazamiento vertical */
            height: 8px; /* Altura de la barra de desplazamiento horizontal */
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.03); /* Pista de la barra de desplazamiento muy sutil */
            border-radius: 10px; /* Bordes redondeados para la pista */
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.15); /* Manija de la barra de desplazamiento suave */
            border-radius: 10px; /* Bordes redondeados para la manija */
            border: 2px solid rgba(255, 255, 255, 0.03); /* Borde casi invisible */
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3); /* Manija al pasar el ratón */
        }

        /* Efecto de cristal (Glassmorphism) para el contenedor principal */
        .glass-effect {
            backdrop-filter: blur(40px) saturate(170%); /* Desenfoque y saturación para el efecto de cristal */
            -webkit-backdrop-filter: blur(40px) saturate(170%); /* Prefijo para WebKit */
            background-color: rgba(220, 220, 220, 0.7); /* Fondo gris claro con transparencia, ligeramente más opaco para contraste */
            border: 1px solid var(--tw-colors-panel-border); /* Borde sutil */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15), /* Sombra exterior más suave y difusa */
                        0 0 15px rgba(0, 0, 0, 0.03), /* Sombra muy sutil para un halo */
                        inset 0 0 10px rgba(255, 255, 255, 0.05); /* Sombra interior para un brillo sutil */
            overflow-y: auto; /* Permite el scroll vertical dentro del panel de cristal */
        }

        /* Animación de pulsación y sombras para los botones principales */
        .button-press-effect {
            transition: all 0.15s cubic-bezier(0.2, 0.8, 0.2, 1); /* Transición elástica y rápida */
            border: none; /* Sin borde */
            outline: none; /* Sin contorno al enfocar */
            position: relative; /* Para el pseudo-elemento de brillo */
            overflow: hidden; /* Oculta el brillo que se extiende fuera del botón */
            background-color: #E6007A; /* Color fucsia sólido */
            background-image: none; /* Asegura que no haya degradados */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25); /* Sombra inicial ligeramente más pronunciada y suave */
            transform: translateZ(0); /* Fuerza la aceleración de hardware */
        }

        /* Pseudo-elemento para el efecto de brillo radial al pasar el ratón */
        .button-press-effect::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0) 70%); /* Brillo radial más sutil */
            opacity: 0; /* Oculto por defecto */
            transition: opacity 0.2s ease-in-out; /* Transición para el brillo */
            pointer-events: none; /* No interfiere con los eventos del ratón en el botón */
        }

        /* Muestra el brillo al pasar el ratón */
        .button-press-effect:hover::before {
            opacity: 1;
        }

        /* Efecto al pasar el ratón y al hacer clic en los botones */
        .button-press-effect:hover,
        .button-press-effect:active {
            transform: translateY(1px) scale(0.97); /* Ligera compresión y hundimiento */
            box-shadow: inset 0 3px 8px rgba(0, 0, 0, 0.5); /* Sombra interior más pronunciada al presionar */
        }

        /* Sombra de texto sutil para los botones */
        .button-press-effect span {
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Sombra más sutil y ambiental para el contenedor principal */
        .main-panel-shadow {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); /* Sombra exterior muy suave y difusa */
        }

        /* Sombra para los iconos del dock y botones (más sutil y difusa) */
        .icon-shadow {
            filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.25)); /* Sombra de icono ligeramente más suave */
        }
        
        /* ===== ESTILOS DEL DOCK ===== */
        .dock-container {
            position: fixed; /* Fija el dock en la parte inferior de la pantalla */
            bottom: 40px; /* Elevación del dock desde la parte inferior */
            left: 0;
            right: 0;
            display: flex;
            justify-content: center; /* Centra el dock horizontalmente */
            padding: 0 10px; /* Padding horizontal para evitar que toque los bordes */
            z-index: 1000; /* Asegura que el dock esté por encima de otros elementos */
        }

        .dock-blur {
            display: flex;
            align-items: center;
            gap: 16px; /* Espacio entre los iconos */
            padding: 12px 24px; /* Padding interno del dock */
            backdrop-filter: blur(20px) saturate(160%); /* Efecto de cristal para el dock */
            -webkit-backdrop-filter: blur(20px) saturate(160%);
            background-color: rgba(60, 60, 65, 0.7); /* Fondo gris oscuro con transparencia, más "socuco" */
            border: 1px solid rgba(255, 255, 255, 0.12); /* Borde sutil */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25); /* Sombra suave y difusa para el dock, ligeramente más fuerte */
            border-radius: 22px; /* Bordes redondeados */
            max-width: 90%; /* Ancho máximo del dock */
            overflow: visible; /* Permite que los íconos escalados sobresalgan */
            white-space: nowrap; /* Evita que los íconos se envuelvan en varias líneas */
            scrollbar-width: none; /* Oculta la barra de desplazamiento en Firefox */
            -ms-overflow-style: none; /* Oculta la barra de desplazamiento en IE/Edge */
        }

        /* Oculta la barra de desplazamiento en navegadores WebKit (Chrome/Safari) */
        .dock-blur::-webkit-scrollbar {
            display: none;
        }

        .dock-icon {
            width: 50px; /* Tamaño base de los iconos del dock */
            height: 50px;
            min-width: 50px; /* Asegura que los iconos no se reduzcan en tamaño */
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.25s cubic-bezier(0.2, 0.8, 0.2, 1); /* Transición suave para los efectos */
            position: relative; /* Necesario para las transformaciones y tooltips */
            cursor: pointer; /* Cambia el cursor a una mano al pasar por encima */
            will-change: transform, filter; /* Optimización de rendimiento para animaciones */
            z-index: 1; /* Z-index base para los iconos */
        }

        .dock-icon svg {
            width: 100%;
            height: 100%;
            color: white; /* Color de los iconos SVG */
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2)); /* Sombra inicial más sutil para los iconos */
            transition: all 0.25s ease; /* Transición para la sombra del icono */
        }

        /* ===== ANIMACIONES DEL DOCK (ESCRITORIO) ===== */
        .dock-icon:hover {
            transform: scale(1.3) translateY(-20px); /* Escala y eleva el icono al pasar el ratón */
            z-index: 10; /* Eleva el z-index para que el icono sobresalga */
        }

        .dock-icon:hover svg {
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.4)); /* Sombra más grande y difusa al pasar el ratón */
        }

        /* ===== TOOLTIPS DEL DOCK ===== */
        .dock-icon::after {
            content: attr(data-tooltip); /* Muestra el texto del atributo data-tooltip */
            position: absolute;
            bottom: 32px; /* Posición del tooltip por encima del icono elevado, ajustado */
            background: rgba(30, 30, 35, 0.8); /* Fondo oscuro para el tooltip, ligeramente más translúcido */
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 500;
            opacity: 0; /* Oculto por defecto */
            transform: translateY(0px); /* Sin transformación inicial */
            transition: opacity 0.2s ease, transform 0.2s ease; /* Transición para mostrar/ocultar */
            white-space: nowrap; /* Evita que el texto del tooltip se envuelva */
            backdrop-filter: blur(5px); /* Desenfoque para el tooltip */
            -webkit-backdrop-filter: blur(5px);
            pointer-events: none; /* No interfiere con los eventos del ratón */
        }

        /* Muestra y eleva el tooltip al pasar el ratón */
        .dock-icon:hover::after {
            opacity: 1;
            transform: translateY(-8px); /* Elevación más sutil del tooltip */
        }

        /* ===== INDICADOR DE ACTIVO DEL DOCK ===== */
        .dock-icon.active::before {
            content: '';
            position: absolute;
            bottom: -6px; /* Posición del punto indicador */
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.9); /* Color del punto indicador */
            border-radius: 50%; /* Forma circular */
        }

        /* ===== EFECTO EN CADENA DEL DOCK (ESCRITORIO) ===== */
        .adjacent-effect {
            transform: scale(1.15) translateY(-10px); /* Escala y eleva iconos adyacentes */
            transition: transform 0.25s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        /* ===== VERSIÓN MÓVIL DEL DOCK (OPTIMIZACIÓN) ===== */
        @media (max-width: 768px) {
            /* Añade padding inferior al body para dejar espacio al dock */
            body {
                padding-bottom: 200px; /* Espacio muy generoso para el dock y la separación */
            }

            .dock-container {
                justify-content: center; /* Centra el dock en móvil */
                padding: 0 10px;
                scrollbar-width: none; /* Oculta la barra de desplazamiento en Firefox */
                -ms-overflow-style: none; /* Oculta la barra de desplazamiento en IE/Edge */
            }
            
            .dock-container::-webkit-scrollbar {
                display: none; /* Oculta la barra de desplazamiento en WebKit */
            }
            
            .dock-blur {
                padding: 10px 20px;
                gap: 14px;
                max-width: none; /* Permite que el dock ocupe todo el ancho disponible */
                width: auto;
                overflow: visible; /* Permite que los iconos sobresalgan */
                overflow-x: auto; /* Habilita el scroll horizontal en el dock para móviles */
                white-space: nowrap; /* Mantiene los iconos en una sola línea */
                scroll-snap-type: x proximity; /* Facilita el desplazamiento por iconos */
                scrollbar-width: none; /* Oculta la barra de desplazamiento en Firefox */
                -ms-overflow-style: none; /* Oculta la barra de desplazamiento en IE/Edge */
            }

            .dock-blur::-webkit-scrollbar {
                display: none; /* Oculta la barra de desplazamiento en WebKit */
            }
            
            .dock-icon {
                width: 42px; /* Tamaño de icono más pequeño para móviles */
                height: 42px;
                min-width: 42px;
                scroll-snap-align: center; /* Alinea los iconos al centro al desplazarse */
            }
            
            /* El efecto de hover en móvil se manejará con :active */
            .dock-icon:hover { 
                transform: scale(1.3) translateY(-20px); 
            }
            .dock-icon:hover svg {
                filter: drop-shadow(0 8px 15px rgba(0, 0, 0, 0.5)); 
            }

            .dock-icon::after {
                font-size: 11px; /* Tamaño de fuente más pequeño para tooltips en móvil */
                bottom: 30px; 
            }
        }

        /* Efecto de acercamiento para móviles (basado en :active) */
        @media (hover: none) { /* Se aplica solo a dispositivos que no soportan hover (típicamente táctiles) */
            .dock-icon:active {
                transform: scale(1.3) translateY(-20px) !important; /* Fuerza el efecto de escala y elevación al tocar */
                z-index: 10 !important; /* Fuerza el z-index */
            }
            .dock-icon:active svg {
                filter: drop-shadow(0 8px 15px rgba(0, 0, 0, 0.5)) !important; /* Fuerza la sombra */
            }
            /* Asegura que el efecto adyacente no interfiera con el :active en móviles */
            .adjacent-effect {
                transform: none !important; 
            }
        }

        /* Ajustes específicos para el botón de Registro de Venta */
        .registro-venta-button {
            /* Por defecto, ocupa el ancho completo de la cuadrícula en pantallas pequeñas */
            width: 100%;
            /* Padding para hacerlo largo y angosto */
            padding: 0.75rem 1.5rem; /* Vertical más pequeño, horizontal estándar */
        }

        .registro-venta-button svg {
            width: 2.5rem; /* Icono más pequeño para el diseño "angosto" */
            height: 2.5rem;
            margin-bottom: 0.5rem; /* Ajuste de margen para el icono */
        }

        .registro-venta-button span {
            font-size: 0.9rem; /* Texto más pequeño para mejor ajuste en el diseño "angosto" */
        }

        /* Ajustes para pantallas medianas (sm) y grandes (md/lg) */
        @media (min-width: 640px) { /* sm breakpoint de Tailwind */
            .registro-venta-button {
                padding: 1rem 2rem; /* Aumenta el padding para pantallas más grandes */
            }
            .registro-venta-button svg {
                width: 3rem; /* Icono un poco más grande */
                height: 3rem;
            }
            .registro-venta-button span {
                font-size: 1.125rem; /* Texto un poco más grande */
            }
        }

        @media (min-width: 768px) { /* md breakpoint de Tailwind */
            .registro-venta-button {
                padding: 1.25rem 2.5rem; /* Padding más generoso para desktop */
            }
            .registro-venta-button svg {
                width: 3.5rem; /* Icono de tamaño completo para desktop */
                height: 3.5rem;
            }
            .registro-venta-button span {
                font-size: 1.25rem; /* Texto de tamaño completo para desktop */
            }
        }

        /* Estilos para el overlay del modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--tw-colors-overlay-dark); /* Fondo oscuro semitransparente, AÚN MÁS OPACo */
            backdrop-filter: blur(10px); /* Desenfoque del fondo ligeramente más fuerte */
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001; /* Por encima del dock */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Estilos base para los modales de cristal */
        .modal-content {
            background-color: rgba(230, 0, 122, 0.3); /* Fondo fucsia semitransparente para efecto cristal, MÁS COLOR */
            backdrop-filter: blur(30px) saturate(180%); /* Efecto de cristal más pronunciado */
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3); /* Borde más visible y claro */
            border-radius: 18px; /* Bordes redondeados */
            /* Sombra para el efecto de rayo brillante */
            box-shadow: 0 0 25px rgba(230, 0, 122, 0.6), /* Resplandor fucsia más intenso */
                        0 15px 40px rgba(230, 0, 122, 0.25), /* Sombra fucsia más grande y profunda */
                        inset 0 0 15px rgba(255, 255, 255, 0.08); /* Brillo interior */
            padding: 2.5rem; /* Padding interno generoso */
            width: 90%; /* Ancho responsivo */
            max-width: 400px; /* Ancho máximo para desktop */
            color: var(--tw-colors-color-blanco); /* Texto blanco para el contenido del modal */
            text-align: center;
            transform: translateY(-20px); /* Empieza ligeramente arriba */
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            animation: pulse-glow 2s infinite alternate; /* Animación de rayo brillante */
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0); /* Se desliza a su posición */
            opacity: 1;
        }

        /* Keyframes para la animación de pulsación del rayo brillante */
        @keyframes pulse-glow {
            from {
                box-shadow: 0 0 15px rgba(230, 0, 122, 0.4), /* Sombra inicial más suave */
                            0 15px 40px rgba(230, 0, 122, 0.25),
                            inset 0 0 15px rgba(255, 255, 255, 0.08);
            }
            to {
                box-shadow: 0 0 35px rgba(230, 0, 122, 0.8), /* Sombra más brillante y extendida */
                            0 15px 40px rgba(230, 0, 122, 0.35),
                            inset 0 0 20px rgba(255, 255, 255, 0.12);
            }
        }


        /* Estilos para el icono grande en la parte superior del modal */
        .modal-header-icon {
            width: 60px; /* Tamaño del icono */
            height: 60px;
            color: var(--tw-colors-fuchsia-exacto); /* Color corporativo */
            margin-bottom: 1.5rem; /* Espacio debajo del icono */
        }

        /* Contenedor para input con icono */
        .input-with-icon {
            position: relative;
            width: 100%;
            margin-bottom: 1rem;
        }

        .input-with-icon input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem; /* Espacio a la izquierda para el icono */
            border-radius: 10px;
            border: 1px solid rgba(230, 0, 122, 0.5); /* Borde fucsia semitransparente */
            background-color: rgba(0, 0, 0, 0.2); /* Fondo oscuro semitransparente */
            outline: none;
            color: var(--tw-colors-color-blanco); /* Texto blanco para input */
            font-size: 1rem;
            transition: border-color 0.2s ease, background-color 0.2s ease;
        }

        .input-with-icon input::placeholder {
            color: rgba(255, 255, 255, 0.6); /* Color del placeholder, ligeramente más claro */
        }

        .input-with-icon input:focus {
            border-color: var(--tw-colors-fuchsia-exacto);
            background-color: rgba(0, 0, 0, 0.3); /* Ligeramente más opaco al enfocar */
        }

        .input-with-icon .input-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 1.5rem;
            height: 1.5rem;
            color: var(--tw-colors-fuchsia-exacto); /* Color del icono como los botones */
        }

        /* Estilos para el checkbox de "Remember me" */
        .checkbox-container {
            display: flex;
            align-items: center;
            justify-content: space-between; /* Alinea el checkbox a la izquierda y el link a la derecha */
            width: 100%;
            margin-bottom: 1.5rem; /* Espacio debajo del checkbox */
            font-size: 0.9rem;
        }

        .checkbox-container input[type="checkbox"] {
            appearance: none; /* Oculta el checkbox nativo */
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 1px solid rgba(230, 0, 122, 0.5); /* Borde fucsia para el checkbox */
            border-radius: 4px;
            background-color: rgba(0, 0, 0, 0.2); /* Fondo oscuro semitransparente */
            cursor: pointer;
            position: relative;
            margin-right: 0.5rem;
            flex-shrink: 0; /* Evita que el checkbox se encoja */
        }

        .checkbox-container input[type="checkbox"]:checked {
            background-color: var(--tw-colors-fuchsia-exacto); /* Color fucsia cuando está marcado */
            border-color: var(--tw-colors-fuchsia-exacto);
        }

        .checkbox-container input[type="checkbox"]:checked::before {
            content: '\2713'; /* Símbolo de checkmark unicode */
            display: block;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--tw-colors-color-blanco);
            font-size: 12px;
            line-height: 1;
        }

        .checkbox-container label {
            display: flex;
            align-items: center;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.8); /* Texto blanco suave para labels */
            font-weight: bold; /* Negrita para labels */
        }

        .checkbox-container a {
            color: var(--tw-colors-fuchsia-exacto); /* Color fucsia para el enlace */
            text-decoration: none;
            font-weight: bold; /* Negrita para el enlace */
            transition: color 0.2s ease;
        }

        .checkbox-container a:hover {
            color: rgba(230, 0, 122, 0.8); /* Fucsia ligeramente más oscuro al pasar el ratón */
            text-decoration: underline;
        }


        /* Estilos para botones dentro de los modales */
        .modal-content button {
            @apply button-press-effect; /* Reutiliza el efecto de botón principal */
            width: 100%;
            padding: 0.75rem 1.5rem;
            margin-top: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--tw-colors-color-blanco);
            border-radius: 12px;
            background-color: var(--tw-colors-fuchsia-exacto);
            box-shadow: 0 6px 12px rgba(230, 0, 122, 0.4); /* Sombra fucsia para el botón */
        }

        .modal-content button.secondary {
            background-color: rgba(255, 255, 255, 0.1); /* Botón secundario más suave */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        .modal-content button.secondary:hover,
        .modal-content button.secondary:active {
            background-color: rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .modal-content h2 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--tw-colors-color-blanco); /* Título blanco */
        }
        .modal-content p {
            font-size: 0.95rem;
            margin-bottom: 1rem;
            color: rgba(255, 255, 255, 0.8); /* Párrafo blanco suave */
        }
        .error-message {
            color: #ef4444; /* Rojo de error de Tailwind (más fuerte) */
            font-size: 0.85rem;
            margin-top: -0.5rem;
            margin-bottom: 1rem;
            text-align: left;
        }
        .success-message {
            color: #22c55e; /* Verde de éxito de Tailwind (más fuerte) */
            font-size: 0.95rem;
            margin-bottom: 1rem;
        }

        /* Estilos específicos para el panel de URLs en la consola de administración */
        .url-mappings-panel {
            background-color: rgba(0, 0, 0, 0.15); /* Fondo ligeramente más oscuro para el panel */
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1.5rem;
            max-height: 250px; /* Altura máxima para permitir scroll */
            overflow-y: auto; /* Habilitar scroll */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .url-mapping-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05); /* Separador sutil */
        }

        .url-mapping-item:last-child {
            border-bottom: none; /* Eliminar borde del último elemento */
        }

        .url-mapping-item label {
            font-weight: bold; /* Negrita para labels */
            color: rgba(255, 255, 255, 0.8); /* Blanco suave para labels */
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .url-mapping-item input[type="text"] {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(230, 0, 122, 0.3); /* Borde fucsia sutil */
            background-color: rgba(0, 0, 0, 0.1); /* Fondo de input más transparente */
            outline: none;
            color: var(--tw-colors-color-blanco);
            font-size: 0.85rem;
            transition: border-color 0.2s ease, background-color 0.2s ease;
        }

        .url-mapping-item input[type="text"]:focus {
            border-color: var(--tw-colors-fuchsia-exacto);
            background-color: rgba(0, 0, 0, 0.2);
        }

        .url-mapping-item select {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(230, 0, 122, 0.3);
            background-color: rgba(0, 0, 0, 0.1);
            color: var(--tw-colors-color-blanco);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            appearance: none; /* Elimina el estilo nativo del select */
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='white'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E"); /* Icono de flecha hacia abajo */
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
        }

        .url-mapping-item select:focus {
            border-color: var(--tw-colors-fuchsia-exacto);
            background-color: rgba(0, 0, 0, 0.2);
            outline: none;
        }

        .url-mapping-item select option {
            background-color: #333; /* Fondo oscuro para las opciones */
            color: var(--tw-colors-color-blanco);
        }

        /* Estilos para la sección de usuarios personalizados */
        .custom-users-section {
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 0.75rem;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.05);
            max-height: 150px; /* Altura máxima para permitir scroll */
            overflow-y: auto; /* Habilitar scroll */
        }

        .custom-user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .custom-user-item:last-child {
            border-bottom: none;
        }

        .custom-user-item button {
            background-color: #ef4444; /* Rojo para eliminar */
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: auto; /* Ancho automático para el botón */
            margin-top: 0; /* Eliminar margen superior del botón general */
            box-shadow: none; /* Eliminar sombra del botón general */
        }

        .custom-user-item button:hover {
            background-color: #dc2626;
        }

        .add-custom-user-inputs {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .add-custom-user-inputs input {
            flex-grow: 1;
            padding: 0.4rem 0.6rem;
            font-size: 0.8rem;
            border-radius: 6px;
        }

        .add-custom-user-inputs button {
            width: auto;
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            margin-top: 0;
            box-shadow: none;
        }

        /* Estilos para la sección de conexiones múltiples */
        .connection-list-section {
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 0.75rem;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.05);
            max-height: 150px; /* Para permitir scroll si hay muchas conexiones */
            overflow-y: auto;
        }

        .connection-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            word-break: break-all; /* Para que las URLs largas no desborden */
        }

        .connection-item:last-child {
            border-bottom: none;
        }

        .connection-item span {
            flex-grow: 1;
            margin-right: 0.5rem;
        }

        .connection-item button {
            background-color: #ef4444; /* Rojo para eliminar */
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: auto; /* Ancho automático para el botón */
            margin-top: 0; /* Eliminar margen superior del botón general */
            box-shadow: none; /* Eliminar sombra del botón general */
            flex-shrink: 0; /* Evita que el botón se encoja */
        }

        .connection-item button:hover {
            background-color: #dc2626;
        }

        .add-connection-inputs {
            display: flex;
            flex-direction: column; /* Apila los inputs verticalmente */
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .add-connection-inputs input {
            flex-grow: 1;
            padding: 0.4rem 0.6rem;
            font-size: 0.8rem;
            border-radius: 6px;
        }

        .add-connection-inputs button {
            width: auto;
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            margin-top: 0;
            box-shadow: none;
        }

        /* Estilos para el modal de selección de conexión */
        #selectConnectionModal .modal-content {
            max-width: 450px;
        }

        #selectConnectionModal .connection-choice-button {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 0.75rem 1.5rem;
            margin-bottom: 0.5rem;
            border-radius: 10px;
            font-weight: 500;
            transition: background-color 0.2s ease;
            width: 100%;
            box-shadow: none; /* Eliminar sombra del botón general */
        }

        #selectConnectionModal .connection-choice-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* --- NUEVOS ESTILOS PARA LOS MODALES DE AUTENTICACIÓN --- */
        /* Modal de Acceso Admin, Acceso Personalizado */
        #adminLoginPromptModal .modal-content,
        #customUserLoginModal .modal-content {
            background-color: rgba(230, 0, 122, 0.3); /* Fondo fucsia semitransparente para efecto cristal, MÁS COLOR */
            backdrop-filter: blur(30px) saturate(180%); /* Efecto de cristal más pronunciado */
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3); /* Borde más visible y claro */
            box-shadow: 0 0 25px rgba(230, 0, 122, 0.6), /* Resplandor fucsia más intenso */
                        0 15px 40px rgba(230, 0, 122, 0.25), /* Sombra fucsia más grande y profunda */
                        inset 0 0 15px rgba(255, 255, 255, 0.08); /* Brillo interior */
            animation: pulse-glow 2s infinite alternate; /* Animación de rayo brillante */
        }

        #adminModal .modal-content {
            background-color: rgba(40, 40, 45, 0.95); /* Fondo oscuro casi opaco */
            backdrop-filter: blur(25px) saturate(150%); /* Desenfoque más suave */
            -webkit-backdrop-filter: blur(25px) saturate(150%);
            border: 1px solid rgba(255, 255, 255, 0.2); /* Borde más definido */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4), /* Sombra más pronunciada */
                        inset 0 0 20px rgba(255, 255, 255, 0.05); /* Brillo interior sutil */
            animation: none; /* Eliminar animación de brillo para este modal */
            color: white; /* Asegurar que el texto principal sea blanco */
            max-width: 500px; /* Aumentar el ancho máximo para el modal de admin */
            max-height: 90vh; /* Permitir que el modal ocupe más altura en pantallas grandes */
            overflow-y: auto; /* Habilitar scroll para el contenido del modal si es necesario */
        }

        #adminModal .input-with-icon input {
            background-color: rgba(255, 255, 255, 0.08); /* Fondo de input más sólido y claro */
            border: 1px solid rgba(255, 255, 255, 0.2); /* Borde más visible */
            color: white; /* Texto del input blanco */
        }

        #adminModal .input-with-icon input::placeholder {
            color: rgba(255, 255, 255, 0.7); /* Placeholder más visible */
        }

        #adminModal .input-with-icon input:focus {
            border-color: var(--tw-colors-fuchsia-exacto); /* Mantener el fucsia al enfocar */
            background-color: rgba(255, 255, 255, 0.15); /* Más claro al enfocar */
        }

        #adminModal .url-mappings-panel,
        #adminModal .custom-users-section,
        #adminModal .connection-list-section {
            background-color: rgba(255, 255, 255, 0.05); /* Fondo más claro y distinto para paneles anidados */
            border: 1px solid rgba(255, 255, 255, 0.1); /* Borde más definido */
        }

        #adminModal .url-mapping-item label {
            color: white; /* Labels blancos */
        }

        #adminModal .url-mapping-item input[type="text"],
        #adminModal .url-mapping-item select,
        #adminModal .add-custom-user-inputs input,
        #adminModal .add-connection-inputs input {
            background-color: rgba(255, 255, 255, 0.1); /* Inputs dentro de paneles anidados */
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: white; /* Texto de inputs en paneles blancos */
        }

        #adminModal .url-mapping-item input[type="text"]::placeholder,
        #adminModal .add-custom-user-inputs input::placeholder,
        #adminModal .add-connection-inputs input::placeholder {
            color: rgba(255, 255, 255, 0.6); /* Placeholder en paneles */
        }

        #adminModal .url-mapping-item select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='white'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E"); /* Icono de flecha hacia abajo blanco */
        }

        #adminModal .url-mapping-item select option {
            background-color: #333; /* Fondo oscuro para las opciones */
            color: var(--tw-colors-color-blanco);
        }

        #adminModal .url-mapping-item input[type="text"]:focus,
        #adminModal .url-mapping-item select:focus,
        #adminModal .add-custom-user-inputs input:focus,
        #adminModal .add-connection-inputs input:focus {
            border-color: var(--tw-colors-fuchsia-exacto);
            background-color: rgba(255, 255, 255, 0.2);
        }

        #adminModal .custom-user-item,
        #adminModal .connection-item {
            color: white; /* Texto más visible en los items */
        }

        #adminModal .modal-header-icon {
            color: var(--tw-colors-fuchsia-exacto); /* Mantener color fucsia para el icono */
        }

        #adminModal h2,
        #adminModal p,
        #adminModal h3 {
            color: white; /* Asegurar que el texto sea blanco */
        }

        /* Estilos para el switch (toggle) */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #E6007A; /* Fuchsia cuando está encendido */
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #E6007A;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* ===================================================================== */
        /* ESTILOS DEL CALENDARIO MODAL (SCOPED) */
        /* ===================================================================== */
        .calendar-body-styles {
            font-family: 'Inter', sans-serif;
            background-color: #0d0d0d; /* Slightly lighter dark background for better contrast with elements */
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            margin: 0;
            overflow: hidden; /* Prevents unwanted scrollbars */
        }

        /* Main Calendar Modal Container (this is the #calendarModalOverlay in the main HTML) */
        #calendarModalOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9); /* More opaque background for main modal */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000; /* High z-index to be on top */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0s 0.5s; /* Smooth transition for show/hide */
        }

        #calendarModalOverlay.active { /* Use 'active' as per main app's modal system */
            opacity: 1;
            visibility: visible;
            transition: opacity 0.5s ease-in-out; /* No delay on show */
        }

        .calendar-close-button { /* Renamed to avoid conflict with other close buttons */
            position: absolute;
            top: 1.25rem; /* Slightly more padding from top */
            right: 1.25rem; /* Slightly more padding from right */
            background-color: #FFD700; /* Gold color */
            color: #1a1a1a; /* Darker text for better contrast */
            border: none;
            border-radius: 50%; /* Circular button */
            width: 2.75rem; /* Slightly larger */
            height: 2.75rem; /* Slightly larger */
            font-size: 1.6rem; /* Slightly larger font */
            font-weight: 700;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6), 0 2px 6px rgba(0, 0, 0, 0.4); /* More pronounced shadow */
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            z-index: 1002; /* Above everything else */
        }

        .calendar-close-button:hover {
            background-color: #e6c200; /* Slightly darker gold on hover */
            transform: scale(1.08); /* More noticeable scale */
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.7), 0 3px 9px rgba(0, 0, 0, 0.5);
        }

        .calendar-close-button:active {
            transform: scale(0.96); /* More noticeable active state */
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.4);
        }

        .year-container-wrapper {
            /* This wrapper exists to contain the year-container and allow it to be transformed */
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%; /* Takes full width of parent modal */
            height: 100%; /* Takes full height of parent modal */
            padding: 0.02rem;
            box-sizing: border-box;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        .year-container {
            background: linear-gradient(160deg, #2c2c2c, #151515); /* Deeper, richer dark gradient */
            border-radius: 1rem; /* Larger rounded corners for a softer look */
            box-shadow: 0 15px 45px rgba(0, 0, 0, 0.9), 0 8px 25px rgba(0, 0, 0, 0.7), inset 0 0 15px rgba(255, 255, 255, 0.08); /* Stronger, multi-layered shadow with inner glow */
            padding: 1.5rem; /* Increased padding for a more spacious feel */
            color: #f0f0f0; /* Brighter text color for better contrast */
            max-width: 95vw; /* Slightly less max-width to ensure some margin */
            max-height: 95vh; /* Slightly less max-height */
            width: fit-content; /* Allows content to dictate width, respecting max-width */
            height: fit-content; /* Allows content to dictate height, respecting max-height */
            position: relative;
            transition: transform 0.5s ease-in-out, filter 0.5s ease-in-out; /* Smooth transition for zoom/unzoom and blur */
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 1; /* Allows it to shrink if content is too large */
            transform-origin: 0 0; /* Set transform origin to top-left for easier calculations */
        }

        /* Class to apply blur and disable interaction to the entire year container when a month is zoomed */
        .year-container.blurred-background {
            filter: blur(8px); /* More intense blur effect */
            pointer-events: none; /* Disable interaction with blurred elements */
        }

        .year-header {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin-bottom: 1rem; /* Increased margin */
        }

        .year-header h2 {
            font-size: 1.8rem; /* Larger text for the year */
            font-weight: 700;
            color: #FFD700; /* Bright golden color */
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.9), 0 0 25px rgba(255, 215, 0, 0.5); /* Brighter, more intense glow */
        }

        .months-grid {
            display: grid;
            /* Default for smallest screens: allow months to shrink significantly */
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)); /* Larger min-width for months */
            gap: 1rem; /* Increased space between months */
            width: 100%;
            justify-items: center; /* Centers months within grid cells */
            /* No blur or pointer-events here directly, handled by .year-container.blurred-background */
        }

        .month-card {
            background: linear-gradient(145deg, #4d4d4d, #222222); /* Dark month background with gradient for glossy effect */
            border-radius: 0.8rem; /* Larger rounded corners */
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.15), inset 0 0 2px rgba(255, 255, 255, 0.1); /* More pronounced shadow with stronger inner glow */
            padding: 0.85rem; /* Increased padding for month card */
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%; /* Ensures card takes available width in grid */
            max-width: 220px; /* Increased max width of each month */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer; /* Indicate it's clickable */
            z-index: 2; /* Default z-index for month cards */
        }

        .month-card:hover {
            transform: translateY(-2px); /* More noticeable hover effect */
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.7), inset 0 0 10px rgba(255, 255, 255, 0.2); /* Enhanced hover shadow */
        }

        /* Styles for the month that is currently zoomed and acting as a modal */
        .month-card.month-modal-active {
            position: fixed; /* Position relative to viewport */
            top: 50%;
            left: 50%;
            /* transform will be set by JS */
            z-index: 1001; /* IMPORTANT: Higher than mainCalendarModal (1000) and modal-overlay (1000) */
            filter: none !important; /* Ensure no blur on the zoomed month */
            box-shadow: 0 25px 75px rgba(0, 0, 0, 0.95), 0 15px 45px rgba(0, 0, 0, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.15); /* Even more prominent shadow for modal with intense inner glow */
            transition: transform 0.5s ease-in-out, box-shadow 0.5s ease; /* Smooth transition for its own movement */
            pointer-events: auto; /* Ensure it's clickable */
        }

        .month-name {
            font-size: 1.1rem; /* Larger month name text */
            font-weight: 600;
            color: #FFD700;
            margin-bottom: 0.6rem; /* Increased margin */
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            width: 100%;
            margin-bottom: 0.3rem; /* Increased margin */
            text-align: center;
            font-weight: 600;
            color: #bbbbbb; /* Slightly lighter gray for weekdays */
            font-size: 0.65rem; /* Larger weekday text */
        }

        .weekday-item {
            padding: 0.15rem 0; /* Increased padding */
            border-bottom: 1px solid rgba(255, 255, 255, 0.15); /* Slightly thicker border */
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.12rem; /* Increased space between days */
            width: 100%;
            text-align: center;
        }

        .day-cell {
            background-color: #555555; /* Slightly lighter day background for better contrast */
            padding: 0.2rem 0.15rem; /* Increased padding */
            border-radius: 0.2rem; /* Slightly larger borders */
            font-size: 0.75rem; /* Larger day text */
            font-weight: 400;
            color: #e0e0e0;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.1s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            aspect-ratio: 1 / 1; /* Ensures cells are square */
            box-shadow: inset 0 0.3px 0.3px rgba(0, 0, 0, 0.3); /* More subtle inner shadow */
        }

        .day-cell:hover:not(.empty):not(.current-day) {
            background-color: #666666; /* Lighter on hover */
            transform: translateY(-0.3px);
            box-shadow: 0 0.8px 2px rgba(0, 0, 0, 0.4);
        }

        .day-cell:active:not(.empty):not(.current-day) {
            transform: translateY(0);
            box-shadow: inset 0 0.3px 0.3px rgba(0, 0, 0, 0.45);
        }

        .empty {
            background-color: transparent;
            cursor: default;
            box-shadow: none;
        }

        .current-day {
            background-color: #FFD700; /* Current day in bright gold */
            color: #121212;
            font-weight: 700;
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.9), inset 0 0.3px 1px rgba(0, 0, 0, 0.5); /* Brighter shadow */
            transform: scale(1.12); /* Slightly more prominent scale */
        }

        /* Zoom and rotation controls */
        .controls {
            margin-top: 1rem; /* Increased margin */
            display: flex;
            gap: 0.8rem; /* Increased space between buttons */
            flex-wrap: wrap; /* Ensures buttons wrap on small screens */
            justify-content: center;
        }

        .control-button {
            background-color: #3a3a3a; /* Dark background for control buttons */
            color: #e0e0e0; /* Light text */
            border: none;
            border-radius: 0.4rem; /* Slightly larger borders */
            padding: 0.5rem 1rem; /* Increased padding */
            font-size: 0.9rem; /* Larger text */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 0.8px 2px rgba(0, 0, 0, 0.4);
        }

        .control-button:hover {
            background-color: #4a4a4a;
            transform: translateY(-0.8px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5);
        }

        .control-button:active {
            transform: translateY(0);
            box-shadow: 0 0.3px 1px rgba(0, 0, 0, 0.4);
        }

        /* Message modal */
        .message-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Darker semi-transparent background */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s ease;
        }

        .message-modal.show {
            visibility: visible;
            opacity: 1;
        }

        .message-content {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a); /* Dark background with gradient for modal */
            color: #e0e0e0;
            padding: 1.2rem; /* Increased padding */
            border-radius: 0.75rem; /* Slightly larger borders */
            text-align: center;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.6);
            max-width: 85vw;
            transform: translateY(-15px);
            transition: transform 0.3s ease;
        }

        .message-modal.show .message-content {
            transform: translateY(0);
        }

        .message-content button {
            margin-top: 1rem; /* Increased margin */
            background-color: #FFD700;
            color: #121212;
            border: none;
            border-radius: 0.3rem; /* Slightly larger borders */
            padding: 0.5rem 1rem; /* Increased padding */
            cursor: pointer;
            font-size: 0.8rem; /* Larger text */
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .message-content button:hover {
            background-color: #e6c200;
            transform: translateY(-0.3px);
        }

        /* Overlay for the month zoom effect (within the calendar modal) */
        .calendar-modal-overlay-inner { /* Renamed to avoid conflict */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75); /* Darker semi-transparent background */
            z-index: 1000; /* Same as mainCalendarModal, or slightly higher if needed */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0s 0.5s; /* Delay visibility on hide */
        }

        .calendar-modal-overlay-inner.show {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.5s ease-in-out; /* No delay on show */
        }

        /* Media queries for responsiveness */
        /* For very small screens (vertical smartphones) */
        @media (max-width: 479px) {
            .months-grid {
                grid-template-columns: repeat(1, 1fr); /* Always 1 column */
                gap: 0.2rem; /* Very reduced space */
            }
            .month-card {
                max-width: 120px; /* Limits card width in single column */
                padding: 0.2rem;
            }
            .year-container {
                padding: 0.2rem;
            }
            .year-header h2 {
                font-size: 1.2rem;
            }
            .month-name {
                font-size: 0.7rem;
            }
            .weekdays {
                font-size: 0.5rem;
            }
            .weekday-item {
                padding: 0.05rem 0;
            }
            .days-grid {
                gap: 0.08rem;
            }
            .day-cell {
                font-size: 0.6rem;
                padding: 0.05rem;
            }
            .controls {
                margin-top: 0.4rem;
                gap: 0.4rem;
            }
            .control-button {
                padding: 0.25rem 0.5rem;
                font-size: 0.6rem;
            }
            .calendar-close-button {
                width: 2rem;
                height: 2rem;
                font-size: 1.2rem;
                top: 0.75rem;
                right: 0.75rem;
            }
        }

        /* For horizontal smartphones or small tablets */
        @media (min-width: 480px) and (max-width: 767px) {
            .months-grid {
                grid-template-columns: repeat(2, 1fr); /* 2 columns */
                gap: 0.4rem;
            }
            .year-container {
                padding: 0.6rem;
            }
            .year-header h2 {
                font-size: 1.4rem;
            }
            .month-name {
                font-size: 0.8rem;
            }
            .weekdays {
                font-size: 0.55rem;
            }
            .day-cell {
                font-size: 0.65rem;
                padding: 0.1rem;
            }
            .controls {
                margin-top: 0.6rem;
                gap: 0.5rem;
            }
            .control-button {
                padding: 0.3rem 0.6rem;
                font-size: 0.7rem;
            }
            .calendar-close-button {
                width: 2.25rem;
                height: 2.25rem;
                font-size: 1.3rem;
                top: 1rem;
                right: 1rem;
            }
        }

        /* For tablets */
        @media (min-width: 768px) and (max-width: 1023px) {
            .months-grid {
                grid-template-columns: repeat(3, 1fr); /* 3 columns */
            }
            .year-container {
                padding: 1rem;
            }
            .year-header h2 {
                font-size: 1.6rem;
            }
            .month-name {
                font-size: 0.9rem;
            }
            .weekdays {
                font-size: 0.6rem;
            }
            .day-cell {
                font-size: 0.7rem;
                padding: 0.12rem;
            }
            .controls {
                margin-top: 0.7rem;
                gap: 0.6rem;
            }
            .control-button {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
        }

        /* For desktops */
        @media (min-width: 1024px) {
            .months-grid {
                grid-template-columns: repeat(4, 1fr); /* 4 columns */
            }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen items-center justify-between p-4 bg-white text-text-dark">

    <!-- Contenedor principal de la consola con efecto de cristal -->
    <div class="flex flex-col items-center justify-center flex-grow w-full max-w-4xl rounded-2xl main-panel-shadow glass-effect p-8 my-4">
        
        <!-- Contenedor para el título FreeWork -->
        <div class="flex flex-col items-center justify-center gap-4 mb-8">
            <!-- Título principal de la aplicación -->
            <h1 class="text-4xl font-bold text-text-dark text-center text-3xl md:text-4xl">FreeWork</h1>
        </div>

        <!-- Área de los 6 botones de la consola, organizados en una cuadrícula responsiva -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-8 md:mb-12 w-full max-w-2xl">
            <!-- Botón 1: Buscador de Direcciones -->
            <button class="button-press-effect flex flex-col items-center justify-center p-4 md:p-6 rounded-xl" aria-label="Buscador de Direcciones" onclick="window.checkAccessAndNavigate('Buscador de Direcciones')">
                <!-- Icono de mapa/ubicación (SVG) -->
                <svg class="w-10 h-10 md:w-12 md:h-12 text-color-blanco mb-1 md:mb-2 icon-shadow" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                </svg>
                <span class="text-color-blanco text-base md:text-lg font-medium text-center">Buscador de Direcciones</span>
            </button>
            <!-- Botón 2: Calculadora de Boleta -->
            <button class="button-press-effect flex flex-col items-center justify-center p-4 md:p-6 rounded-xl" aria-label="Calculadora de Boleta" onclick="window.checkAccessAndNavigate('Calculadora de Boleta')">
                <!-- Icono de documento/factura (SVG) -->
                <svg class="w-10 h-10 md:w-12 md:h-12 text-color-blanco mb-1 md:mb-2 icon-shadow" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2zm0-4H7V7h10v2z"/>
                </svg>
                <span class="text-color-blanco text-base md:text-lg font-medium text-center">Calculadora de Boleta</span>
            </button>
            <!-- Botón 3: Evaluar RUT -->
            <button class="button-press-effect flex flex-col items-center justify-center p-4 md:p-6 rounded-xl" aria-label="Evaluar RUT" onclick="window.checkAccessAndNavigate('Evaluar RUT')">
                <!-- Icono de usuario/persona (SVG) -->
                <svg class="w-10 h-10 md:w-12 md:h-12 text-color-blanco mb-1 md:mb-2 icon-shadow" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M21 2H3c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-9 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 14H6v-1.4c0-2.66 5.33-4 8-4s8 1.34 8 4V19z"/>
                </svg>
                <span class="text-color-blanco text-base md:text-lg font-medium text-center">Evaluar RUT</span>
            </button>
            <!-- Botón 4: Condiciones Comerciales -->
            <button class="button-press-effect flex flex-col items-center justify-center p-4 md:p-6 rounded-xl" aria-label="Condiciones Comerciales" onclick="window.checkAccessAndNavigate('Condiciones Comerciales')">
                <!-- Icono de documento/página (SVG) -->
                <svg class="w-10 h-10 md:w-12 md:h-12 text-color-blanco mb-1 md:mb-2 icon-shadow" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                </svg>
                <span class="text-color-blanco text-base md:text-lg font-medium text-center">Condiciones Comerciales</span>
            </button>
            <!-- Botón 5: Factibilidad -->
            <button class="button-press-effect flex flex-col items-center justify-center p-4 md:p-6 rounded-xl" aria-label="Factibilidad" onclick="window.checkAccessAndNavigate('Factibilidad')">
                <!-- Icono de ubicación/pin (SVG) -->
                <svg class="w-10 h-10 md:w-12 md:h-12 text-color-blanco mb-1 md:mb-2 icon-shadow" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2c-4.97 0-9 4.03-9 9 0 3.03 1.48 5.73 3.79 7.42L12 22l5.21-3.58C19.52 16.73 21 14.03 21 11c0-4.97-4.03-9-9-9zm0 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/>
                </svg>
                <span class="text-color-blanco text-base md:text-lg font-medium text-center">Factibilidad</span>
            </button>
            <!-- Botón 6: Configuración -->
            <button class="button-press-effect flex flex-col items-center justify-center p-4 md:p-6 rounded-xl" aria-label="Configuración" onclick="window.openAdminLoginModal()">
                <!-- Icono de engranaje (SVG) -->
                <svg class="w-10 h-10 md:w-12 md:h-12 text-color-blanco mb-1 md:mb-2 icon-shadow" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.39-1.09-.72-1.71-.97l-.36-2.69c-.05-.24-.27-.42-.52-.42h-4c-.25 0-.47.18-.52.42l-.36 2.69c-.62.25-1.19.58-1.71.97l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c.12-.22-.07.49.12.64l2.11 1.65c-.04.32-.07.64-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12-.22.39.3.61.22l2.49-1c-.52.39 1.09.72 1.71.97l.36 2.69c.05.24.27.42.52.42h4c.25 0 .47-.18.52-.42l-.36-2.69c.62-.25 1.19-.58 1.71-.97l2.49 1c-.22.09-.49 0-.61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>
                </svg>
                <span class="text-color-blanco text-base md:text-lg font-medium text-center">Configuración</span>
            </button>

            <!-- Botón central: Registro de Venta (más grande y prominente) -->
            <button class="button-press-effect flex flex-col items-center justify-center rounded-2xl w-full mx-auto mt-6 col-span-full
                           registro-venta-button"
                    aria-label="Registro de Venta" onclick="window.checkAccessAndNavigate('Registro de Venta')">
                <!-- Icono de carrito de compras/caja (SVG) -->
                <svg class="text-color-blanco icon-shadow" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M18 6h-2c0-2.21-1.79-4-4-4S8 3.79 8 6H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-4 0c0-1.1.9-2 2-2s2 .9 2 2h-4z"/>
                </svg>
                <span class="font-semibold text-color-blanco">Registro de Venta</span>
            </button>
        </div>
    </div>

    <!-- DOCK PRINCIPAL (barra de aplicaciones estilo macOS) -->
    <div class="dock-container">
        <nav class="dock-blur" id="macosDock">
            <!-- Icono Inicio -->
            <div class="dock-icon active" 
                 data-tooltip="Inicio"
                 data-action="page"
                 data-target="index.html"
                 onclick="window.checkAccessAndNavigateDock('Inicio')">
                <!-- Icono de casa (SVG) -->
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
            </div>
            
            <!-- Icono Configuración -->
            <div class="dock-icon" 
                 data-tooltip="Configuración"
                 data-action="page"
                 data-target="config.html"
                 onclick="window.openAdminLoginModal()">
                <!-- Icono de engranaje (SVG) -->
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12-.22.37-.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41-.48.41h3.84c-.24 0 .44-.17.47-.41l-.36-2.54c-.59-.24-1.13-.56-1.62-.94l2.39-.96c-.22-.08-.47 0-.59.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                </svg>
            </div>
            
            <!-- Icono Informes -->
            <div class="dock-icon" 
                 data-tooltip="Informes"
                 data-action="page"
                 data-target="reports.html"
                 onclick="window.checkAccessAndNavigateDock('Informes')">
                <!-- Icono de gráfico de barras (SVG) -->
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                </svg>
            </div>
            
            <!-- Icono Desplegar -->
            <div class="dock-icon" 
                 data-tooltip="Desplegar"
                 data-action="page"
                 data-target="deploy.html"
                 onclick="window.checkAccessAndNavigateDock('Desplegar')">
                <!-- Icono de flecha hacia arriba (SVG) -->
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
            </div>
            
            <!-- Icono Smart -->
            <div class="dock-icon" 
                 data-tooltip="Smart"
                 data-action="page"
                 data-target="smart.html"
                 onclick="window.checkAccessAndNavigateDock('Smart')">
                <!-- Icono de bombilla/inteligencia (SVG) -->
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9-4.03-9-9-9zm0 16c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7zm1-11h-2v6h2V8zm0 8h-2v2h2v-2z"/>
                </svg>
            </div>
            
            <!-- Icono Calendario (formerly Agenda) -->
            <div class="dock-icon" 
                 data-tooltip="Calendario"
                 data-action="modal"
                 data-target="calendarModalOverlay"
                 onclick="window.checkAccessAndNavigateDock('Calendario')">
                <!-- Icono de calendario (SVG) -->
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/>
                </svg>
            </div>
            
            <!-- Icono Correo -->
            <div class="dock-icon" 
                 data-tooltip="Correo"
                 data-action="page"
                 data-target="mail.html"
                 onclick="window.checkAccessAndNavigateDock('Correo')">
                <!-- Icono de sobre/correo (SVG) -->
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                </svg>
            </div>
            
            <!-- Icono Mensajes -->
            <div class="dock-icon" 
                 data-tooltip="Mensajes"
                 data-action="page"
                 data-target="messages.html"
                 onclick="window.checkAccessAndNavigateDock('Mensajes')">
                <!-- Icono de burbuja de chat (SVG) -->
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                </svg>
            </div>
            
            <!-- Icono Perfil -->
            <div class="dock-icon" 
                 data-tooltip="Perfil"
                 data-action="page"
                 data-target="profile.html"
                 onclick="window.checkAccessAndNavigateDock('Perfil')">
                <!-- Icono de perfil de usuario (SVG) -->
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                </svg>
            </div>
        </nav>
    </div>

    <!-- MODAL DE ACCESO DE ADMINISTRADOR -->
    <div id="adminLoginPromptModal" class="modal-overlay">
        <div class="modal-content">
            <svg class="modal-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
                <path d="M17 17V9a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v8"></path>
                <path d="M7 17H5a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h2"></path>
                <path d="M17 17H19a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2"></path>
            </svg>
            <h2>Acceso de Administrador de FreeWork</h2>
            <p>Introduce la clave de administrador para acceder a la configuración.</p>
            <div class="input-with-icon">
                <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
                    <path d="M17 17V9a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v8"></path>
                    <path d="M7 17H5a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h2"></path>
                    <path d="M17 17H19a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2"></path>
            </svg>
                <input type="password" id="adminKeyPromptInput" placeholder="Clave de Administrador">
            </div>
            <div class="checkbox-container">
                <label for="rememberMeCheckbox">
                    <input type="checkbox" id="rememberMeCheckbox">
                    Recordarme (10 días)
                </label>
            </div>
            <p id="adminLoginErrorMessage" class="error-message hidden"></p>
            <button onclick="window.handleAdminLoginPrompt()">Acceder</button>
            <button onclick="window.hideModal('adminLoginPromptModal')" class="secondary">Cancelar</button>
        </div>
    </div>

    <!-- MODAL DE ACCESO PERSONALIZADO -->
    <div id="customUserLoginModal" class="modal-overlay">
        <div class="modal-content">
            <svg class="modal-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <!-- Los textos del título y el párrafo se establecerán dinámicamente -->
            <h2 id="customModalTitle">Acceso Personalizado a FreeWork</h2> 
            <p id="customModalMessage">Introduce tu nombre y código para acceder.</p>
            <div class="input-with-icon">
                <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <input type="text" id="customUserNameInput" placeholder="Tu Nombre">
            </div>
            <div class="input-with-icon">
                <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
                    <path d="M17 17V9a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v8"></path>
                    <path d="M7 17H5a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h2"></path>
                    <path d="M17 17H19a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2"></path>
                </svg>
                <input type="password" id="customUserCodeInput" placeholder="Código de 3 dígitos" maxlength="3">
            </div>
            <p id="customUserLoginErrorMessage" class="error-message hidden"></p>
            <button onclick="window.handleCustomUserLogin()">Ingresar</button>
            <!-- Nuevo botón para solicitar clave por WhatsApp -->
            <button onclick="window.requestKeyViaWhatsApp()" class="secondary">Solicitar Clave por WhatsApp</button>
            <button onclick="window.hideModal('customUserLoginModal')" class="secondary">Cancelar</button>
        </div>
    </div>

    <!-- MODAL DE CONSOLA DE ADMINISTRACIÓN -->
    <div id="adminModal" class="modal-overlay">
        <div class="modal-content">
            <svg class="modal-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.39-1.09-.72-1.71-.97l-.36-2.69c-.05-.24-.27-.42-.52-.42h-4c-.25 0-.47.18-.52.42l-.36 2.69c-.62.25-1.19.58-1.71.97l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c.12-.22-.07.49.12.64l2.11 1.65c-.04.32-.07.64-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12-.22.39.3.61.22l2.49-1c-.52.39 1.09.72 1.71.97l.36 2.69c.05.24.27.42.52.42h4c.25 0 .47-.18.52-.42l-.36-2.69c.62-.25 1.19-.58 1.71-.97l2.49 1c-.22.09-.49 0-.61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>
            </svg>
            <h2>Consola de Administración de FreeWork</h2>
            <p>Gestiona las claves y las conexiones de los botones.</p>
            
            <!-- Clave de Administrador -->
            <label for="adminAdminKeyInput" class="block text-left font-bold mb-1">Clave de Administrador:</label>
            <div class="input-with-icon">
                <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
                    <path d="M17 17V9a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v8"></path>
                    <path d="M7 17H5a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h2"></path>
                    <path d="M17 17H19a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2"></path>
                </svg>
                <input type="password" id="adminAdminKeyInput" placeholder="Nueva Clave de Administrador">
            </div>

            <p id="adminConsoleMessage" class="success-message hidden"></p>
            
            <!-- Botón "Cerrar" -->
            <button onclick="window.hideModal('adminModal')" class="secondary">Cerrar</button>

            <h3 class="text-color-blanco font-bold text-lg mt-4 mb-2">Conexiones de Botones</h3>
            <div id="urlMappingsPanel" class="url-mappings-panel">
                <!-- Las conexiones de los botones se cargarán aquí dinámicamente -->
            </div>
        </div>
    </div>

    <!-- MODAL DE SELECCIÓN DE CONEXIÓN (NUEVO) -->
    <div id="selectConnectionModal" class="modal-overlay">
        <div class="modal-content">
            <h2>Seleccionar Conexión</h2>
            <p id="selectConnectionMessage">Elige la conexión para <span id="currentButtonName"></span>:</p>
            <div id="connectionButtonsContainer" class="flex flex-col gap-2 mt-4">
                <!-- Los botones de conexión se cargarán aquí dinámicamente -->
            </div>
            <button onclick="window.hideModal('selectConnectionModal')" class="secondary mt-4">Cancelar</button>
        </div>
    </div>

    <!-- CALENDARIO MODAL DE PANTALLA COMPLETA -->
    <div id="calendarModalOverlay" class="calendar-modal-overlay">
        <button class="calendar-close-button" id="closeCalendarModalButton">X</button>
        <div class="calendar-body-styles">
            <div class="year-container-wrapper">
                <div class="year-container" id="calendarContentContainer">
                    <div class="year-header">
                        <h2 id="currentYearDisplay"></h2>
                    </div>
                    <div class="months-grid" id="monthsGrid">
                        <!-- Months will be generated here with JavaScript -->
                    </div>
                    <div class="controls">
                        <button class="control-button" id="prevYear">Año Anterior</button>
                        <button class="control-button" id="nextYear">Año Siguiente</button>
                        <button class="control-button" id="zoomIn">Aumentar tamaño (+)</button>
                        <button class="control-button" id="zoomOut">Reducir tamaño (-)</button>
                        <button class="control-button" id="resetView">Restablecer vista</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Custom message modal (scoped to calendar for now) -->
        <div id="calendarMessageModal" class="message-modal">
            <div class="message-content">
                <p id="calendarMessageText"></p>
                <button id="closeCalendarMessageModal">Cerrar</button>
            </div>
        </div>

        <!-- Overlay for the month zoom effect (scoped to calendar for now) -->
        <div class="calendar-modal-overlay-inner" id="calendarMonthOverlay"></div>
    </div>

    <!-- SCRIPT MEJORADO PARA LA FUNCIONALIDAD DE LA CONSOLA Y EL DOCK -->
    <script type="module">
        // Importar módulos de Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // =====================================================================
        // VARIABLES GLOBALES
        // =====================================================================
        let app;
        let db;
        let auth;
        let userId;
        let appSettingsRef; // Referencia al documento de configuración de la app
        let adminKey = "superadmin"; // Clave de administrador por defecto

        // Bandera para asegurar que los listeners de input se añadan solo una vez y cuando Firebase esté listo
        let firebaseReadyForInputListeners = false;

        // Global variable to store the promise that resolves when Firebase Auth is ready and userId is set
        let authReadyPromise;

        // Mapeo de URLs por defecto para los botones principales y del dock.
        // Cada entrada tiene un array 'connections' para soportar múltiples URLs y un tipo de acceso.
        let urlMappings = {
            "Buscador de Direcciones": { connections: [{ label: "Buscador de Direcciones", url: "https://visordirecciones2-production.up.railway.app/" }], access: "general", customUsers: [] },
            "Calculadora de Boleta": { connections: [{ label: "Calculadora de Boleta", url: "https://sites.google.com/view/ciclofacturacionwom/p%C3%A1gina-principal" }], access: "general", customUsers: [] },
            "Evaluar RUT": { connections: [{ label: "Evaluar RUT", url: "https://www.wom.cl/paga-aqui/" }], access: "general", customUsers: [] },
            "Condiciones Comerciales": { connections: [{ label: "Condiciones Comerciales", url: "https://drive.google.com/drive/folders/1RFC7V23aiver5fL8iN-lneFGNLY7Hvp2?usp=sharing" }], access: "general", customUsers: [] },
            "Factibilidad": { connections: [{ label: "Factibilidad", url: "https://sso-ocp4-sr-amp.apps.sr-ocp.wom.cl/auth/realms/customer-care/protocol/openid-connect/auth?client_id=e7c0d592&redirect_uri=https%3A%2F%2Fcustomercareapplicationservice.ose.wom.cl%2Fwomac%2Flogin&state=e2dd136e-8c38-4633-8184-4a77187b3817&response_mode=fragment&response_type=code&scope=openid&nonce=f9ae47e6-8b9c-4a69-9e94-80dd90ef2410" }], access: "general", customUsers: [] },
            "Registro de Venta": { connections: [{ label: "Registro de Venta", url: "https://sites.google.com/view/ciclowom/p%C3%A1gina-principal" }], access: "general", customUsers: [] },
            "Inicio": { connections: [{ label: "Página Principal (index.html)", url: "index.html" }], access: "general", customUsers: [] },
            "Configuración": { connections: [{ label: "Consola Admin", url: "config.html" }], access: "admin", customUsers: [] }, 
            "Informes": { connections: [{ label: "Informes Demo", url: "reports.html" }], access: "general", customUsers: [] },
            "Desplegar": { connections: [{ label: "Despliegue Demo", url: "deploy.html" }], access: "general", customUsers: [] },
            "Smart": { connections: [{ label: "Smart Demo", url: "smart.html" }], access: "general", customUsers: [] },
            "Calendario": { connections: [{ label: "Calendario Anual", url: "#calendarModal" }], access: "general", customUsers: [] }, // Updated to Calendario
            "Correo": { connections: [{ label: "Correo Demo", url: "mail.html" }], access: "general", customUsers: [] },
            "Mensajes": { connections: [{ label: "WhatsApp", url: "https://web.whatsapp.com/" }], access: "general", customUsers: [] },
            "Perfil": { connections: [{ label: "Perfil Demo", url: "profile.html" }], access: "general", customUsers: [] }
        };

        // Variables globales para almacenar detalles de navegación pendiente para acceso de administrador/personalizado
        let pendingNavigationButtonName = null;
        let adminLoginForConsole = false; // Bandera para distinguir el inicio de sesión de administrador para la consola vs. navegación

        // Referencias a elementos del DOM para modales y sus contenidos
        const adminLoginPromptModal = document.getElementById('adminLoginPromptModal');
        const adminModal = document.getElementById('adminModal');
        const customUserLoginModal = document.getElementById('customUserLoginModal'); 
        const selectConnectionModal = document.getElementById('selectConnectionModal');
        const calendarModalOverlay = document.getElementById('calendarModalOverlay'); // New calendar modal

        const adminKeyPromptInput = document.getElementById('adminKeyPromptInput');
        const adminLoginErrorMessage = document.getElementById('adminLoginErrorMessage');
        const rememberMeCheckbox = document.getElementById('rememberMeCheckbox');
        
        const customUserNameInput = document.getElementById('customUserNameInput');
        const customUserCodeInput = document.getElementById('customUserCodeInput');
        const customUserLoginErrorMessage = document.getElementById('customUserLoginErrorMessage');

        const adminAdminKeyInput = document.getElementById('adminAdminKeyInput');
        const adminConsoleMessage = document.getElementById('adminConsoleMessage');
        const urlMappingsPanel = document.getElementById('urlMappingsPanel');

        const customModalTitle = document.getElementById('customUserLoginModal').querySelector('h2');
        const customModalMessage = document.getElementById('customUserLoginModal').querySelector('p');

        const currentButtonNameSpan = document.getElementById('currentButtonName');
        const connectionButtonsContainer = document.getElementById('connectionButtonsContainer');

        // Constante para la duración del "recordarme" (10 días en milisegundos)
        const REMEMBER_ME_DURATION_MS = 10 * 24 * 60 * 60 * 1000; // 10 días

        // =====================================================================
        // FUNCIONES DE UTILIDAD
        // =====================================================================

        /**
         * Función de debounce para limitar la frecuencia de ejecución de una función.
         * Útil para eventos como 'input' para evitar guardar en exceso en la base de datos.
         * @param {function} func - La función a ejecutar después del retraso.
         * @param {number} delay - El tiempo en milisegundos para esperar antes de ejecutar la función.
         * @returns {function} Una nueva función que retrasa la ejecución de `func`.
         */
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        /**
         * Muestra un modal específico y el overlay.
         * Oculta cualquier otro modal activo antes de mostrar el nuevo.
         * @param {string} modalId - El ID del modal a mostrar.
         */
        window.showModal = function(modalId) {
            // Ocultar todos los modales primero para asegurar que solo uno esté activo
            adminLoginPromptModal.classList.remove('active');
            adminModal.classList.remove('active');
            customUserLoginModal.classList.remove('active'); 
            selectConnectionModal.classList.remove('active');
            calendarModalOverlay.classList.remove('active'); // Ensure calendar modal is also hidden

            const modal = document.getElementById(modalId);
            if (modal) {
                // Lógica específica para el modal de acceso personalizado (customUserLoginModal)
                if (modalId === 'customUserLoginModal') {
                    const buttonName = pendingNavigationButtonName;
                    if (buttonName === 'Mensajes') {
                        customModalTitle.textContent = "Acceso a WhatsApp";
                        customModalMessage.textContent = "Introduce tu nombre de usuario y el código de 3 dígitos enviado a tu WhatsApp para acceder.";
                    } else {
                        customModalTitle.textContent = "Acceso Personalizado a FreeWork";
                        customModalMessage.textContent = "Introduce tu nombre y código para acceder.";
                    }
                }

                modal.classList.add('active');
                // Limpiar mensajes de error/éxito al mostrar el modal
                adminLoginErrorMessage.classList.add('hidden');
                adminConsoleMessage.classList.add('hidden');
                customUserLoginErrorMessage.classList.add('hidden'); 
            }
        }

        /**
         * Oculta un modal específico y el overlay.
         * @param {string} modalId - El ID del modal a ocultar.
         */
        window.hideModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }

        /**
         * Añade listeners a los overlays de los modales para cerrarlos al hacer clic fuera del contenido.
         */
        function setupModalOverlayListeners() {
            const modals = [adminLoginPromptModal, adminModal, customUserLoginModal, selectConnectionModal, calendarModalOverlay];
            modals.forEach(modal => {
                if (modal) {
                    modal.addEventListener('click', (event) => {
                        // Solo cerrar si el clic es directamente en el overlay, no en el contenido del modal
                        if (event.target === modal) {
                            window.hideModal(modal.id);
                        }
                    });
                }
            });
        }

        // =====================================================================
        // FUNCIONES DE FIREBASE Y CONFIGURACIÓN DE LA APLICACIÓN
        // =====================================================================

        /**
         * Inicializa Firebase y autentica al usuario (anónimamente si no hay token).
         * Carga la configuración de la aplicación desde Firestore.
         */
        async function initializeFirebase() {
            try {
                // Asegurar que __app_id esté definido, usando un valor por defecto si no lo está.
                const appId = typeof __app_id !== 'undefined' && __app_id ? __app_id : 'default-app-id';
                let firebaseConfig = {};

                // Intentar parsear __firebase_config, con manejo de errores y valores por defecto.
                if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                    try {
                        firebaseConfig = JSON.parse(__firebase_config);
                    } catch (e) {
                        console.error("Error al parsear __firebase_config. Asegúrate de que sea un JSON válido:", e);
                        firebaseConfig = { projectId: 'default-project-id' }; // Fallback seguro
                    }
                } else {
                    console.warn("La configuración de Firebase (__firebase_config) no está definida o está vacía. Usando un projectId por defecto.");
                    firebaseConfig = { projectId: 'default-project-id' }; // Fallback seguro
                }
                
                // Asegurar que projectId exista en la configuración de Firebase.
                if (!firebaseConfig.projectId) {
                    console.warn("La configuración de Firebase no contiene 'projectId'. Usando un projectId por defecto.");
                    firebaseConfig.projectId = 'default-project-id';
                }

                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Establecer appSettingsRef aquí, tan pronto como db esté disponible.
                // Esto asegura que appSettingsRef es un objeto DocumentReference válido.
                appSettingsRef = doc(db, `artifacts/${appId}/public/data/app_settings`);

                // Create a promise that resolves when auth state is determined and userId is set
                authReadyPromise = new Promise(resolve => {
                    const unsubscribe = onAuthStateChanged(auth, async (user) => {
                        if (user) {
                            userId = user.uid;
                            console.log("Usuario autenticado con ID:", userId);
                        } else {
                            try {
                                await signInAnonymously(auth);
                                // After anonymous sign-in, onAuthStateChanged will fire again with a user,
                                // so this block will be re-entered. We need to ensure we don't resolve twice.
                                return; 
                            } catch (anonError) {
                                console.error("Error al iniciar sesión anónimamente:", anonError);
                                userId = null; // If anonymous sign-in fails, userId remains null
                            }
                        }
                        // Only resolve the promise once userId is determined (even if null due to error)
                        if (userId !== undefined) { // Check if userId has been assigned a value
                            unsubscribe(); // Stop listening to auth changes after the first determination
                            resolve();
                        }
                    });
                });

                // Wait for authentication to be ready before proceeding with loading settings and enabling listeners
                await authReadyPromise;

                await loadAppSettings();

                // Only add the listener if it hasn't been added and Firebase is ready.
                if (!firebaseReadyForInputListeners) {
                    adminAdminKeyInput.addEventListener('input', debounce(window.saveAppSettings, 500));
                    firebaseReadyForInputListeners = true;
                }

            } catch (error) {
                console.error("Error crítico al inicializar Firebase o configurar la autenticación:", error);
            }
        }

        /**
         * Carga la configuración de la aplicación (clave de administrador y mapeos de URL) desde Firestore.
         * Si no existe el documento de configuración, guarda los valores por defecto.
         */
        async function loadAppSettings() {
            // Este console.log es útil para depurar el estado de appSettingsRef
            console.log("loadAppSettings: appSettingsRef está listo?", appSettingsRef !== null && appSettingsRef !== undefined);

            if (!appSettingsRef) {
                console.warn("appSettingsRef no está inicializado. No se puede cargar la configuración.");
                return;
            }
            try {
                const settingsSnap = await getDoc(appSettingsRef);
                if (settingsSnap.exists()) {
                    const data = settingsSnap.data();
                    adminKey = data.adminKey || "superadmin"; // Usar clave por defecto si no está en Firestore
                    
                    if (data.urlMappings) {
                        // Fusionar la configuración cargada con la configuración por defecto
                        // Esto asegura que los nuevos botones añadidos en el código no se pierdan
                        // y que las propiedades (connections, access, customUsers) estén completas.
                        for (const key in urlMappings) { // Iterar sobre las claves por defecto
                            const defaultItem = urlMappings[key];
                            const storedItem = data.urlMappings[key];

                            if (storedItem) {
                                let connectionsArray = [];
                                if (storedItem.connections && Array.isArray(storedItem.connections)) {
                                    connectionsArray = storedItem.connections;
                                } else if (storedItem.url) { // Compatibilidad con formato antiguo (si solo había una URL)
                                    connectionsArray = [{ label: defaultItem.connections[0]?.label || key, url: storedItem.url }];
                                } else {
                                    connectionsArray = []; // Si no hay conexiones ni URL, inicializar vacío
                                }

                                urlMappings[key] = {
                                    connections: connectionsArray,
                                    access: storedItem.access || defaultItem.access,
                                    customUsers: storedItem.customUsers || defaultItem.customUsers || []
                                };
                            } else {
                                // Si la clave existe en el default pero no en Firestore, mantener la configuración por defecto
                                urlMappings[key] = defaultItem;
                            }
                        }
                        // También añadir cualquier clave que exista en Firestore pero no en los defaults (si aplica)
                        for (const key in data.urlMappings) {
                            if (!urlMappings.hasOwnProperty(key)) {
                                urlMappings[key] = data.urlMappings[key];
                            }
                        }

                    }
                    console.log("Configuración cargada desde Firestore:", { adminKey: adminKey, urlMappings: urlMappings });
                } else {
                    console.log("No hay configuración guardada en Firestore. Usando valores por defecto y guardándolos.");
                    // Guardar los valores por defecto si el documento no existe
                    await window.saveAppSettings(); 
                }
            } catch (error) {
                console.error("Error al cargar la configuración de la aplicación desde Firestore:", error);
                // En caso de error, la aplicación seguirá usando los urlMappings por defecto definidos en el código.
            }
        }

        /**
         * Guarda la configuración actual de la aplicación (clave de administrador y mapeos de URL) en Firestore.
         * Esta función es global para ser accesible desde los listeners de eventos del DOM.
         * @returns {boolean} - True si se guardó exitosamente, false en caso contrario.
         */
        window.saveAppSettings = async function() {
            // Este console.log es útil para depurar el estado de appSettingsRef y userId
            console.log("saveAppSettings: appSettingsRef está listo?", appSettingsRef !== null && appSettingsRef !== undefined, "userId:", userId);

            // Mostrar mensajes de error al usuario si las condiciones previas no se cumplen.
            if (!userId) {
                console.error("Error interno: No hay usuario autenticado. La operación de guardado no se realizará.");
                adminConsoleMessage.textContent = "Error: No se pudo guardar. No hay usuario autenticado.";
                adminConsoleMessage.style.color = '#ef4444';
                adminConsoleMessage.classList.remove('hidden');
                setTimeout(() => { adminConsoleMessage.classList.add('hidden'); }, 3000);
                return false;
            }
            if (!appSettingsRef) {
                console.error("Internal error: appSettingsRef is not initialized. Save operation will not proceed.");
                adminConsoleMessage.textContent = "Error: No se pudo guardar. La referencia de configuración no está lista.";
                adminConsoleMessage.style.color = '#ef4444';
                adminConsoleMessage.classList.remove('hidden');
                setTimeout(() => { adminConsoleMessage.classList.add('hidden'); }, 3000);
                return false;
            }
            try {
                // Actualizar la clave de administrador desde el input del modal
                adminKey = adminAdminKeyInput.value.trim();

                const updatedUrlMappings = {};
                // Recorrer los elementos del panel de mapeo de URLs para reconstruir el objeto urlMappings
                const urlItems = urlMappingsPanel.querySelectorAll('.url-mapping-item');
                urlItems.forEach(item => {
                    const buttonName = item.querySelector('label').textContent;
                    const accessSelect = item.querySelector('select');
                    
                    const customUsers = [];
                    // Solo recopilar usuarios personalizados si el tipo de acceso es 'custom'
                    if (accessSelect.value === 'custom') {
                        const customUserItems = item.querySelectorAll('.custom-user-item');
                        customUserItems.forEach(userItem => {
                            const nameSpan = userItem.querySelector('span:first-child');
                            const codeSpan = userItem.querySelector('span:nth-child(2)');
                            if (nameSpan && codeSpan) {
                                customUsers.push({
                                    name: nameSpan.textContent.replace('Nombre: ', '').trim(),
                                    code: codeSpan.textContent.replace('Código: ', '').trim()
                                });
                            }
                        });
                    }

                    const connections = [];
                    // Recopilar todas las conexiones para este botón
                    const connectionItems = item.querySelectorAll('.connection-item');
                    connectionItems.forEach(connItem => {
                        const labelSpan = connItem.querySelector('span:first-child');
                        const urlSpan = connItem.querySelector('span:nth-child(2)');
                        if (labelSpan && urlSpan) {
                            connections.push({
                                label: labelSpan.textContent.replace('Etiqueta: ', '').trim(),
                                url: urlSpan.textContent.replace('URL: ', '').trim()
                            });
                        }
                    });
                    
                    // Construir el objeto para este botón
                    updatedUrlMappings[buttonName] = {
                        connections: connections,
                        access: accessSelect.value,
                        customUsers: customUsers
                    };
                });
                urlMappings = updatedUrlMappings; // Actualizar el objeto global con los datos del DOM

                // Guardar el objeto completo en Firestore
                await setDoc(appSettingsRef, {
                    adminKey: adminKey,
                    urlMappings: urlMappings
                });

                adminConsoleMessage.textContent = "¡Cambios guardados exitosamente!";
                adminConsoleMessage.style.color = '#22c55e'; // Verde de éxito
                adminConsoleMessage.classList.remove('hidden');
                setTimeout(() => { adminConsoleMessage.classList.add('hidden'); }, 2000); // Ocultar mensaje después de 2 segundos
                return true;
            } catch (error) {
                console.error("Error al guardar la configuración en Firestore:", error);
                adminConsoleMessage.textContent = "Error al guardar los cambios. Inténtalo de nuevo.";
                adminConsoleMessage.style.color = '#ef4444'; // Rojo de error
                adminConsoleMessage.classList.remove('hidden');
                return false;
            }
        }

        // =====================================================================
        // LÓGICA DE ACCESO Y AUTENTICACIÓN
        // =====================================================================

        /**
         * Abre el modal de solicitud de clave de administrador para acceder a la consola de administración.
         */
        window.openAdminLoginModal = function() {
            adminLoginForConsole = true; // Indica que el login es para la consola de admin
            window.showModal('adminLoginPromptModal');
            adminKeyPromptInput.value = ''; // Limpiar el campo de entrada
            adminLoginErrorMessage.classList.add('hidden'); // Ocultar mensajes de error previos

            // Intentar cargar la clave de administrador guardada
            const storedAdminKeyData = localStorage.getItem('freework_admin_key');
            if (storedAdminKeyData) {
                try {
                    const parsedData = JSON.parse(storedAdminKeyData);
                    if (parsedData.expiry && parsedData.expiry > Date.now()) {
                        adminKeyPromptInput.value = parsedData.key;
                        rememberMeCheckbox.checked = true;
                    } else {
                        localStorage.removeItem('freework_admin_key'); // Eliminar clave expirada
                        rememberMeCheckbox.checked = false;
                    }
                } catch (e) {
                    console.error("Error al parsear la clave de administrador guardada:", e);
                    localStorage.removeItem('freework_admin_key');
                    rememberMeCheckbox.checked = false;
                }
            } else {
                rememberMeCheckbox.checked = false;
            }
        }

        /**
         * Abre el modal de solicitud de clave de administrador para una navegación restringida.
         * Se utiliza cuando un botón normal de la consola requiere acceso de administrador.
         * @param {string} buttonName - El nombre del botón que activó la solicitud.
         */
        window.promptAdminAccess = function(buttonName) {
            adminLoginForConsole = false; // Indica que el login es para la navegación de un botón
            pendingNavigationButtonName = buttonName; // Guarda el nombre del botón para navegar después
            window.showModal('adminLoginPromptModal');
            adminKeyPromptInput.value = ''; // Limpiar el campo de entrada
            adminLoginErrorMessage.classList.add('hidden'); // Ocultar mensajes de error previos
            rememberMeCheckbox.checked = false; // Por defecto, no recordar para navegaciones
        };

        /**
         * Maneja el intento de inicio de sesión para el administrador.
         * Si la clave es correcta, abre la consola de administración o realiza la navegación pendiente.
         */
        window.handleAdminLoginPrompt = function() {
            const enteredAdminKey = adminKeyPromptInput.value.trim();
            if (enteredAdminKey === adminKey) {
                // Si el checkbox "Recordarme" está marcado, guardar la clave en localStorage
                if (rememberMeCheckbox.checked) {
                    const expiryTimestamp = Date.now() + REMEMBER_ME_DURATION_MS;
                    localStorage.setItem('freework_admin_key', JSON.stringify({ key: enteredAdminKey, expiry: expiryTimestamp }));
                } else {
                    localStorage.removeItem('freework_admin_key'); // Si no está marcado, eliminar cualquier clave guardada
                }

                window.hideModal('adminLoginPromptModal'); // Ocultar el modal de solicitud de clave
                if (adminLoginForConsole) {
                    window.showModal('adminModal'); // Mostrar el modal de la consola de administración
                    adminAdminKeyInput.value = adminKey; // Rellenar el campo de clave en la consola
                    renderUrlMappings(); // Renderizar el panel de URLs y accesos
                    adminConsoleMessage.classList.add('hidden'); // Ocultar mensajes de la consola
                } else {
                    // Si el login era para navegar a un botón, realizar la navegación
                    if (pendingNavigationButtonName) {
                        // isDockIcon es false porque viene de un botón principal
                        handleButtonConnections(pendingNavigationButtonName, false); 
                        pendingNavigationButtonName = null; // Limpiar la navegación pendiente
                    }
                }
            } else {
                adminLoginErrorMessage.textContent = "Clave de administrador incorrecta.";
                adminLoginErrorMessage.classList.remove('hidden'); // Mostrar mensaje de error
            }
        }

        /**
         * Maneja el intento de inicio de sesión para acceso personalizado.
         * Si las credenciales son correctas, guarda el acceso en localStorage y realiza la navegación.
         */
        window.handleCustomUserLogin = function() {
            const enteredName = customUserNameInput.value.trim();
            const enteredCode = customUserCodeInput.value.trim();

            // Validar que se hayan introducido ambos campos y que el código tenga 3 dígitos
            if (!enteredName || enteredCode.length !== 3) {
                customUserLoginErrorMessage.textContent = "Por favor, introduce un nombre y un código de 3 dígitos.";
                customUserLoginErrorMessage.classList.remove('hidden');
                return;
            }

            // Obtener la configuración del botón que activó el modal personalizado
            const buttonConfig = urlMappings[pendingNavigationButtonName];
            // Buscar si el usuario y el código coinciden con alguno de los usuarios personalizados configurados
            const foundUser = buttonConfig.customUsers.find(user => user.name === enteredName && user.code === enteredCode);

            if (foundUser) {
                // Si las credenciales son correctas, guardar el acceso en localStorage con una fecha de expiración
                const expiryTimestamp = Date.now() + REMEMBER_ME_DURATION_MS;
                localStorage.setItem(`freework_custom_access_${userId}`, JSON.stringify({
                    name: enteredName,
                    code: enteredCode,
                    expiry: expiryTimestamp
                }));

                customUserLoginErrorMessage.textContent = "Acceso concedido. No se te pedirá la clave por 10 días.";
                customUserLoginErrorMessage.style.color = '#22c55e'; // Verde de éxito
                customUserLoginErrorMessage.classList.remove('hidden');

                // Ocultar el modal y navegar después de un breve retraso para que el usuario vea el mensaje de éxito
                setTimeout(() => {
                    window.hideModal('customUserLoginModal');
                    // Determinar si la navegación es para un icono del dock (abre en nueva pestaña)
                    const isDockIcon = ['Inicio', 'Configuración', 'Informes', 'Desplegar', 'Smart', 'Calendario', 'Correo', 'Mensajes', 'Perfil'].includes(pendingNavigationButtonName);
                    handleButtonConnections(pendingNavigationButtonName, isDockIcon);
                    pendingNavigationButtonName = null; // Limpiar la navegación pendiente
                    customUserNameInput.value = ''; // Limpiar campos del formulario
                    customUserCodeInput.value = '';
                }, 1500);
            } else {
                customUserLoginErrorMessage.textContent = "Nombre o código incorrecto.";
                customUserLoginErrorMessage.classList.remove('hidden'); // Mostrar mensaje de error
            }
        };

        /**
         * Simula la solicitud de una clave por WhatsApp.
         * Abre una nueva ventana de WhatsApp con un mensaje predefinido para el administrador.
         */
        window.requestKeyViaWhatsApp = function() {
            const enteredName = customUserNameInput.value.trim();
            if (!enteredName) {
                customUserLoginErrorMessage.textContent = "Por favor, introduce tu nombre para solicitar la clave.";
                customUserLoginErrorMessage.classList.remove('hidden');
                return;
            }

            // Número de teléfono del administrador para WhatsApp (ejemplo, reemplazar con el real)
            // NOTA: En un sistema de producción, este número debería ser configurable en el panel de administración
            // y guardado en Firestore, no hardcodeado aquí.
            const adminPhoneNumber = "56912345678"; // Formato: código de país + número, sin '+' ni espacios
            const message = encodeURIComponent(`Hola, soy ${enteredName} y necesito la clave de acceso para la aplicación FreeWork.`);
            const whatsappUrl = `https://wa.me/${adminPhoneNumber}?text=${message}`;

            window.open(whatsappUrl, '_blank'); // Abrir WhatsApp en una nueva pestaña

            customUserLoginErrorMessage.textContent = `Clave solicitada para ${enteredName}. Revisa tu WhatsApp.`;
            customUserLoginErrorMessage.style.color = '#22c55e'; // Verde de éxito
            customUserLoginErrorMessage.classList.remove('hidden');
            customUserCodeInput.value = ''; // Opcional: limpiar el campo de código para una nueva entrada
        };

        // =====================================================================
        // RENDERIZADO DE LA CONSOLA DE ADMINISTRACIÓN
        // =====================================================================

        /**
         * Renderiza dinámicamente el panel para editar las URLs y accesos de los botones.
         * Este panel se muestra dentro del modal de administración.
         */
        function renderUrlMappings() {
            urlMappingsPanel.innerHTML = ''; // Limpiar contenido previo para evitar duplicados
            // Iterar sobre cada botón configurado en urlMappings
            for (const buttonName in urlMappings) {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('url-mapping-item');

                const label = document.createElement('label');
                label.textContent = buttonName; // Nombre del botón
                itemDiv.appendChild(label);

                // Sección para gestionar conexiones múltiples (URL y etiqueta)
                const connectionListSection = document.createElement('div');
                connectionListSection.classList.add('connection-list-section');
                itemDiv.appendChild(connectionListSection);
                // Renderizar las conexiones existentes y el formulario para añadir nuevas
                renderConnections(buttonName, urlMappings[buttonName].connections, connectionListSection);

                // Selector de tipo de acceso (General, Administrador, Personalizado)
                const accessSelect = document.createElement('select');
                accessSelect.setAttribute('data-button-name', buttonName); // Asociar el select al nombre del botón
                
                // Opciones del selector
                const generalOption = document.createElement('option');
                generalOption.value = 'general';
                generalOption.textContent = 'Acceso General';
                accessSelect.appendChild(generalOption);

                const adminOption = document.createElement('option');
                adminOption.value = 'admin';
                adminOption.textContent = 'Acceso Administrador';
                accessSelect.appendChild(adminOption);

                const customOption = document.createElement('option');
                customOption.value = 'custom';
                customOption.textContent = 'Acceso Personalizado';
                accessSelect.appendChild(customOption);

                accessSelect.value = urlMappings[buttonName].access; // Seleccionar el valor actual
                itemDiv.appendChild(accessSelect);

                // Sección para usuarios personalizados (inicialmente oculta si el acceso no es 'custom')
                const customUsersSection = document.createElement('div');
                customUsersSection.classList.add('custom-users-section');
                customUsersSection.style.display = accessSelect.value === 'custom' ? 'block' : 'none';
                itemDiv.appendChild(customUsersSection);

                // Si el acceso es 'custom', renderizar los usuarios personalizados existentes
                if (accessSelect.value === 'custom') {
                    renderCustomUsers(buttonName, urlMappings[buttonName].customUsers, customUsersSection);
                }

                // Listener para cambiar la visibilidad de la sección de usuarios personalizados
                // y guardar los cambios al cambiar el tipo de acceso
                accessSelect.onchange = () => {
                    if (accessSelect.value === 'custom') {
                        customUsersSection.style.display = 'block';
                        renderCustomUsers(buttonName, urlMappings[buttonName].customUsers, customUsersSection);
                    } else {
                        customUsersSection.style.display = 'none';
                    }
                    debounce(window.saveAppSettings, 100)(); // Guardar con debounce
                };

                urlMappingsPanel.appendChild(itemDiv); // Añadir el elemento completo al panel
            }
        }

        /**
         * Renderiza las conexiones (URLs) para un botón específico en el panel de administración.
         * Incluye los inputs para añadir nuevas conexiones y botones para eliminar las existentes.
         * @param {string} buttonName - El nombre del botón al que pertenecen las conexiones.
         * @param {Array<Object>} connections - Array de objetos {label, url} de las conexiones.
         * @param {HTMLElement} sectionElement - El elemento DOM donde se renderizarán las conexiones.
         */
        function renderConnections(buttonName, connections, sectionElement) {
            sectionElement.innerHTML = ''; // Limpiar contenido previo
            connections.forEach((conn, index) => {
                const connItem = document.createElement('div');
                connItem.classList.add('connection-item');
                connItem.innerHTML = `
                    <span>Etiqueta: ${conn.label}</span>
                    <span>URL: ${conn.url}</span>
                    <button data-index="${index}" class="remove-connection-button">Eliminar</button>
                `;
                sectionElement.appendChild(connItem);
            });

            // Inputs para añadir una nueva conexión
            const addInputsDiv = document.createElement('div');
            addInputsDiv.classList.add('add-connection-inputs');
            addInputsDiv.innerHTML = `
                <input type="text" placeholder="Etiqueta (ej. Página 2)" class="new-connection-label">
                <input type="text" placeholder="URL (ej. https://ejemplo.com/pagina2)" class="new-connection-url">
                <button class="add-connection-button">Agregar Conexión</button>
            `;
            sectionElement.appendChild(addInputsDiv);

            // Listener para los botones de eliminar conexión
            sectionElement.querySelectorAll('.remove-connection-button').forEach(button => {
                button.onclick = (e) => {
                    const indexToRemove = parseInt(e.target.dataset.index);
                    urlMappings[buttonName].connections.splice(indexToRemove, 1); // Eliminar del array
                    renderConnections(buttonName, urlMappings[buttonName].connections, sectionElement); // Volver a renderizar
                    window.saveAppSettings(); // Guardar cambios en Firestore
                };
            });

            // Listener para el botón de añadir conexión
            sectionElement.querySelector('.add-connection-button').onclick = () => {
                const newLabelInput = sectionElement.querySelector('.new-connection-label');
                const newUrlInput = sectionElement.querySelector('.new-connection-url');
                const newLabel = newLabelInput.value.trim();
                const newUrl = newUrlInput.value.trim();

                if (newLabel && newUrl) {
                    urlMappings[buttonName].connections.push({ label: newLabel, url: newUrl }); // Añadir al array
                    newLabelInput.value = ''; // Limpiar inputs
                    newUrlInput.value = '';
                    renderConnections(buttonName, urlMappings[buttonName].connections, sectionElement); // Volver a renderizar
                    window.saveAppSettings(); // Guardar cambios en Firestore
                } else {
                    // Mostrar mensaje de error si los campos están vacíos
                    const errorMsg = document.createElement('p');
                    errorMsg.textContent = "Error: La etiqueta y la URL no pueden estar vacías.";
                    errorMsg.style.color = '#ef4444';
                    errorMsg.style.fontSize = '0.75rem';
                    errorMsg.style.marginTop = '0.5rem';
                    sectionElement.appendChild(errorMsg);
                    setTimeout(() => { errorMsg.remove(); }, 3000); // Ocultar mensaje después de 3 segundos
                }
            };

            // Listeners con debounce para guardar automáticamente al cambiar los inputs
            sectionElement.querySelectorAll('.new-connection-label, .new-connection-url').forEach(input => {
                input.addEventListener('input', debounce(window.saveAppSettings, 500));
            });
        }

        /**
         * Renderiza los usuarios personalizados para un botón específico en el panel de administración.
         * Incluye inputs para añadir nuevos usuarios y botones para eliminar los existentes.
         * @param {string} buttonName - El nombre del botón al que pertenecen los usuarios.
         * @param {Array<Object>} users - Array de objetos {name, code} de los usuarios.
         * @param {HTMLElement} sectionElement - El elemento DOM donde se renderizarán los usuarios.
         */
        function renderCustomUsers(buttonName, users, sectionElement) {
            sectionElement.innerHTML = ''; // Limpiar contenido previo
            users.forEach((user, index) => {
                const userItem = document.createElement('div');
                userItem.classList.add('custom-user-item');
                userItem.innerHTML = `
                    <span>Nombre: ${user.name}</span>
                    <span>Código: ${user.code}</span>
                    <button data-index="${index}" class="remove-custom-user">Eliminar</button>
                `;
                sectionElement.appendChild(userItem);
            });

            // Inputs para añadir un nuevo usuario personalizado
            const addInputsDiv = document.createElement('div');
            addInputsDiv.classList.add('add-custom-user-inputs');
            addInputsDiv.innerHTML = `
                <input type="text" placeholder="Nuevo Nombre" class="new-custom-user-name">
                <input type="text" placeholder="Código (3 dígitos)" maxlength="3" class="new-custom-user-code">
                <button class="add-custom-user-button">Agregar</button>
            `;
            sectionElement.appendChild(addInputsDiv);

            // Listener para los botones de eliminar usuario
            sectionElement.querySelectorAll('.remove-custom-user').forEach(button => {
                button.onclick = (e) => {
                    const indexToRemove = parseInt(e.target.dataset.index);
                    urlMappings[buttonName].customUsers.splice(indexToRemove, 1); // Eliminar del array
                    renderCustomUsers(buttonName, urlMappings[buttonName].customUsers, sectionElement); // Volver a renderizar
                    window.saveAppSettings(); // Guardar cambios en Firestore
                };
            });

            // Listener para el botón de añadir usuario
            sectionElement.querySelector('.add-custom-user-button').onclick = () => {
                const newNameInput = sectionElement.querySelector('.new-custom-user-name');
                const newCodeInput = sectionElement.querySelector('.new-custom-user-code');
                const newName = newNameInput.value.trim();
                const newCode = newCodeInput.value.trim();

                // Validar que el nombre no esté vacío y el código tenga exactamente 3 dígitos
                if (newName && newCode.length === 3) {
                    urlMappings[buttonName].customUsers.push({ name: newName, code: newCode }); // Añadir al array
                    newNameInput.value = ''; // Limpiar inputs
                    newCodeInput.value = '';
                    renderCustomUsers(buttonName, urlMappings[buttonName].customUsers, sectionElement); // Volver a renderizar
                    window.saveAppSettings(); // Guardar cambios en Firestore
                } else {
                    // Mostrar mensaje de error si la validación falla
                    const errorMsg = document.createElement('p');
                    errorMsg.textContent = "Error: Introduce un nombre y un código válido de 3 dígitos.";
                    errorMsg.style.color = '#ef4444';
                    errorMsg.style.fontSize = '0.75rem';
                    errorMsg.style.marginTop = '0.5rem';
                    sectionElement.appendChild(errorMsg);
                    setTimeout(() => { errorMsg.remove(); }, 3000); // Ocultar mensaje después de 3 segundos
                }
            };

            // Listeners con debounce para guardar automáticamente al cambiar los inputs
            sectionElement.querySelectorAll('.new-custom-user-name, .new-custom-user-code').forEach(input => {
                input.addEventListener('input', debounce(window.saveAppSettings, 500));
            });
        }

        /**
         * Muestra el modal de selección de conexión y lo puebla con las opciones disponibles.
         * @param {string} buttonName - El nombre del botón que se está activando.
         * @param {Array<Object>} connections - Array de objetos {label, url} de las conexiones disponibles.
         * @param {boolean} isDockIcon - Indica si la navegación proviene de un icono del dock (abre en nueva pestaña).
         */
        window.showConnectionSelectionModal = function(buttonName, connections, isDockIcon) {
            currentButtonNameSpan.textContent = buttonName; // Actualizar el nombre del botón en el modal
            connectionButtonsContainer.innerHTML = ''; // Limpiar botones anteriores para evitar duplicados

            // Mostrar un mensaje si no hay conexiones configuradas
            if (connections.length === 0) {
                const noConnectionsMessage = document.createElement('p');
                noConnectionsMessage.textContent = "No hay conexiones configuradas para este botón.";
                noConnectionsMessage.style.color = '#ef4444';
                connectionButtonsContainer.appendChild(noConnectionsMessage);
                window.showModal('selectConnectionModal'); // Asegurarse de mostrar el modal incluso si está vacío
                return;
            }

            // Crear un botón para cada conexión disponible
            connections.forEach(conn => {
                const button = document.createElement('button');
                button.classList.add('connection-choice-button');
                button.textContent = conn.label;
                button.onclick = () => {
                    window.hideModal('selectConnectionModal'); // Ocultar el modal al seleccionar una conexión
                    if (isDockIcon) {
                        window.open(conn.url, '_blank'); // Abrir en nueva pestaña si es un icono del dock
                    } else {
                        window.location.href = conn.url; // Navegar en la misma pestaña
                    }
                };
                connectionButtonsContainer.appendChild(button);
            });

            window.showModal('selectConnectionModal'); // Mostrar el modal de selección
        };

        // =====================================================================
        // LÓGICA DE NAVEGACIÓN Y ACCESO DE BOTONES
        // =====================================================================

        /**
         * Función auxiliar para manejar la navegación después de las comprobaciones de acceso.
         * Determina si se abre una URL directamente o se muestra un modal de selección de conexiones.
         * @param {string} buttonName - El nombre del botón que se está activando.
         * @param {boolean} isDockIcon - Indica si la navegación proviene de un icono del dock (abre en nueva pestaña).
         */
        function handleButtonConnections(buttonName, isDockIcon = false) {
            const buttonConfig = urlMappings[buttonName];
            if (!buttonConfig) {
                console.warn(`Configuración no encontrada para el botón: ${buttonName}.`);
                return;
            }

            // Special handling for the Calendar modal
            if (buttonName === 'Calendario' && buttonConfig.connections[0].url === '#calendarModal') {
                window.openCalendarModal();
                return;
            }

            if (!buttonConfig.connections || buttonConfig.connections.length === 0) {
                console.warn(`No hay conexiones configuradas para el botón: ${buttonName}.`);
                window.showConnectionSelectionModal(buttonName, [], isDockIcon); // Mostrar modal vacío con mensaje
                return;
            }

            // If there's only one connection, navigate directly
            if (buttonConfig.connections.length === 1) {
                const finalUrl = buttonConfig.connections[0].url;
                if (isDockIcon) {
                    window.open(finalUrl, '_blank');
                } else {
                    window.location.href = finalUrl;
                }
            } else {
                // If there are multiple connections, show the selection modal
                window.showConnectionSelectionModal(buttonName, buttonConfig.connections, isDockIcon);
            }
        }

        /**
         * Verifica el acceso antes de navegar para los botones principales de la consola.
         * @param {string} buttonName - El nombre del botón.
         */
        window.checkAccessAndNavigate = function(buttonName) {
            const buttonConfig = urlMappings[buttonName];
            if (!buttonConfig) {
                console.warn(`Configuración no encontrada para el botón: ${buttonName}.`);
                return;
            }

            if (buttonConfig.access === 'admin') {
                window.promptAdminAccess(buttonName); // Solicitar clave de administrador
            } else if (buttonConfig.access === 'custom') {
                const storedAccess = localStorage.getItem(`freework_custom_access_${userId}`);
                let hasValidStoredAccess = false;
                if (storedAccess) {
                    try {
                        const parsedAccess = JSON.parse(storedAccess);
                        // Verificar si el acceso almacenado es válido y no ha expirado
                        const foundUserInConfig = buttonConfig.customUsers.find(user =>
                            user.name === parsedAccess.name && user.code === parsedAccess.code
                        );

                        if (parsedAccess.expiry && parsedAccess.expiry > Date.now() && foundUserInConfig) {
                            hasValidStoredAccess = true;
                        } else {
                            // Si el acceso ha expirado o no coincide, eliminarlo de localStorage
                            localStorage.removeItem(`freework_custom_access_${userId}`);
                        }
                    } catch (e) {
                        console.error("Error al parsear el acceso personalizado almacenado:", e);
                        localStorage.removeItem(`freework_custom_access_${userId}`);
                    }
                }

                if (hasValidStoredAccess) {
                    handleButtonConnections(buttonName, false); // Acceso válido, navegar
                } else {
                    pendingNavigationButtonName = buttonName; // Guardar botón pendiente
                    window.showModal('customUserLoginModal'); // Mostrar modal de acceso personalizado
                }
            } else { // access === 'general'
                handleButtonConnections(buttonName, false); // Acceso general, navegar directamente
            }
        }

        /**
         * Verifica el acceso antes de navegar para los iconos del dock.
         * Los iconos del dock siempre abren enlaces en una nueva pestaña.
         * @param {string} iconName - El nombre del icono.
         */
        window.checkAccessAndNavigateDock = function(iconName) {
            const iconConfig = urlMappings[iconName];
            if (!iconConfig) {
                console.warn(`Configuración no encontrada para el icono del dock: ${iconName}.`);
                return;
            }

            if (iconConfig.access === 'admin') {
                window.promptAdminAccess(iconName); // Solicitar clave de administrador
            } else if (iconConfig.access === 'custom') {
                const storedAccess = localStorage.getItem(`freework_custom_access_${userId}`);
                let hasValidStoredAccess = false;
                if (storedAccess) {
                    try {
                        const parsedAccess = JSON.parse(storedAccess);
                        // Verificar si el acceso almacenado es válido y no ha expirado
                        const foundUserInConfig = iconConfig.customUsers.find(user =>
                            user.name === parsedAccess.name && user.code === parsedAccess.code
                        );

                        if (parsedAccess.expiry && parsedAccess.expiry > Date.now() && foundUserInConfig) {
                            hasValidStoredAccess = true;
                        } else {
                            // Si el acceso ha expirado o no coincide, eliminarlo de localStorage
                            localStorage.removeItem(`freework_custom_access_${userId}`);
                        }
                    } catch (e) {
                        console.error("Error al parsear el acceso personalizado almacenado para el icono del dock:", e);
                        localStorage.removeItem(`freework_custom_access_${userId}`);
                    }
                }

                if (hasValidStoredAccess) {
                    handleButtonConnections(iconName, true); // Acceso válido, navegar en nueva pestaña
                } else {
                    pendingNavigationButtonName = iconName; // Guardar icono pendiente
                    window.showModal('customUserLoginModal'); // Mostrar modal de acceso personalizado
                }
            } else { // access === 'general'
                handleButtonConnections(iconName, true); // Acceso general, navegar en nueva pestaña
            }
        }

        // =====================================================================
        // LÓGICA DEL DOCK macOS (ANIMACIONES)
        // =====================================================================

        /**
         * Configura las animaciones y el comportamiento del dock macOS.
         * Incluye efectos de magnificación, efecto en cadena y scroll táctil para móviles.
         */
        function setupDockAnimations() {
            const dock = document.getElementById('macosDock');
            const icons = dock.querySelectorAll('.dock-icon');
            // Determinar si el dispositivo es móvil (no soporta hover)
            const isMobile = window.matchMedia('(max-width: 768px)').matches;
            
            // Aplicar efectos de hover y adyacentes solo en dispositivos no móviles
            if (!isMobile) {
                icons.forEach(icon => {
                    icon.addEventListener('mouseenter', () => {
                        const index = Array.from(icons).indexOf(icon);
                        // Aplicar efecto a icono anterior si existe
                        if (icons[index - 1]) {
                            icons[index - 1].classList.add('adjacent-effect');
                        }
                        // Aplicar efecto a icono siguiente si existe
                        if (icons[index + 1]) {
                            icons[index + 1].classList.add('adjacent-effect');
                        }
                    });
                    
                    icon.addEventListener('mouseleave', () => {
                        // Eliminar el efecto de todos los iconos adyacentes al salir del hover
                        icons.forEach(icon => {
                            icon.classList.remove('adjacent-effect');
                        });
                    });
                });
            }
            
            // Listener para el clic en los iconos del dock (actualiza el estado 'active')
            icons.forEach(icon => {
                icon.addEventListener('click', () => {
                    // Remover la clase 'active' de todos los iconos
                    icons.forEach(i => i.classList.remove('active'));
                    // Añadir la clase 'active' al icono clicado
                    icon.classList.add('active');
                });
            });
            
            // Manejo de scroll táctil para el dock en móviles (para arrastrar el dock)
            if (isMobile) {
                let startX, scrollLeft;
                let isDown = false; // Bandera para saber si el toque está presionado
                
                // Prevenir el comportamiento por defecto de 'touchmove' para evitar scroll de página
                dock.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                }, { passive: false }); // Usar passive: false para permitir preventDefault

                // Al iniciar el toque
                dock.addEventListener('touchstart', (e) => {
                    isDown = true;
                    startX = e.touches[0].pageX - dock.offsetLeft; // Posición inicial del toque
                    scrollLeft = dock.scrollLeft; // Posición inicial del scroll del dock
                }, { passive: false });

                // Al mover el dedo sobre el dock
                dock.addEventListener('touchmove', (e) => {
                    if (!isDown) return; // Si no está presionado, salir
                    e.preventDefault();
                    const x = e.touches[0].pageX - dock.offsetLeft; // Posición actual del toque
                    const walk = (x - startX) * 2; // Calcular el desplazamiento (multiplicar por 2 para mayor sensibilidad)
                    dock.scrollLeft = scrollLeft - walk; // Ajustar la posición de scroll
                }, { passive: false });

                // Al levantar el dedo
                dock.addEventListener('touchend', () => {
                    isDown = false; // Resetear la bandera
                });
            }
        }

        // =====================================================================
        // LÓGICA DEL CALENDARIO (INTEGRADO COMO MODAL)
        // =====================================================================
        function initializeCalendar() {
            const calendarContentContainer = document.getElementById('calendarContentContainer');
            const closeCalendarModalButton = document.getElementById('closeCalendarModalButton');

            const currentYearDisplay = calendarContentContainer.querySelector('#currentYearDisplay');
            const monthsGrid = calendarContentContainer.querySelector('#monthsGrid');
            const prevYearBtn = calendarContentContainer.querySelector('#prevYear');
            const nextYearBtn = calendarContentContainer.querySelector('#nextYear');
            const zoomInBtn = calendarContentContainer.querySelector('#zoomIn');
            const zoomOutBtn = calendarContentContainer.querySelector('#zoomOut');
            const resetViewBtn = calendarContentContainer.querySelector('#resetView');
            const calendarMonthOverlay = document.getElementById('calendarMonthOverlay'); // Inner overlay for month zoom

            const calendarMessageModal = document.getElementById('calendarMessageModal');
            const calendarMessageText = document.getElementById('calendarMessageText');
            const closeCalendarMessageModalBtn = document.getElementById('closeCalendarMessageModal');

            let currentYear = new Date().getFullYear();
            let rotationZ = 0;
            let scaleFactor = 0.75; // Initial scale factor set to 0.75 for better visibility
            let translateX = 0;
            let translateY = 0;

            let zoomedMonthElement = null;
            let originalMonthParent = null;
            let originalMonthNextSibling = null;
            let originalYearContainerState = { translateX: 0, translateY: 0, scaleFactor: 1, rotationZ: 0 };

            let isDragging = false;
            let startX, startY;
            let startRotationZ, startTranslateX, startTranslateY;
            let lastX, lastY;
            let lastTime;
            let velocityX = 0;
            let velocityY = 0;
            let velocityZ = 0;

            let animationFrameId;

            function showCalendarMessage(message) {
                calendarMessageText.textContent = message;
                calendarMessageModal.classList.add('show');
            }

            closeCalendarMessageModalBtn.addEventListener('click', () => {
                calendarMessageModal.classList.remove('show');
            });

            function renderMonth(monthIndex, year, monthContainerDiv) {
                monthContainerDiv.innerHTML = '';

                const today = new Date();
                const firstDayOfMonth = new Date(year, monthIndex, 1);
                const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();
                const startDayOfWeek = firstDayOfMonth.getDay();

                const monthName = new Date(year, monthIndex).toLocaleString('es-ES', { month: 'long' });

                const monthNameHeader = document.createElement('h3');
                monthNameHeader.classList.add('month-name');
                monthNameHeader.textContent = monthName.replace(/\b\w/g, char => char.toUpperCase());

                monthContainerDiv.appendChild(monthNameHeader);

                const weekdaysDiv = document.createElement('div');
                weekdaysDiv.classList.add('weekdays');
                const dayNames = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
                dayNames.forEach(day => {
                    const span = document.createElement('span');
                    span.classList.add('weekday-item');
                    span.textContent = day;
                    weekdaysDiv.appendChild(span);
                });
                monthContainerDiv.appendChild(weekdaysDiv);

                const daysGridDiv = document.createElement('div');
                daysGridDiv.classList.add('days-grid');

                for (let i = 0; i < startDayOfWeek; i++) {
                    const emptyCell = document.createElement('span');
                    emptyCell.classList.add('day-cell', 'empty');
                    daysGridDiv.appendChild(emptyCell);
                }

                for (let i = 1; i <= daysInMonth; i++) {
                    const dayCell = document.createElement('span');
                    dayCell.classList.add('day-cell');
                    dayCell.textContent = i;
                    dayCell.dataset.day = i;
                    dayCell.dataset.month = monthIndex;
                    dayCell.dataset.year = year;

                    if (i === today.getDate() && monthIndex === today.getMonth() && year === today.getFullYear()) {
                        dayCell.classList.add('current-day');
                    }

                    dayCell.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (!dayCell.classList.contains('empty')) {
                            showCalendarMessage(`Has seleccionado el ${i} de ${monthNameHeader.textContent} de ${year}.`);
                        }
                    });

                    daysGridDiv.appendChild(dayCell);
                }
                monthContainerDiv.appendChild(daysGridDiv);
            }

            function renderYear() {
                monthsGrid.innerHTML = '';
                currentYearDisplay.textContent = currentYear;

                for (let i = 0; i < 12; i++) {
                    const monthCard = document.createElement('div');
                    monthCard.classList.add('month-card');
                    renderMonth(i, currentYear, monthCard);
                    monthCard.addEventListener('click', handleMonthClick);
                    monthsGrid.appendChild(monthCard);
                }
            }

            function applyTransformations() {
                calendarContentContainer.style.transform = `translate(${translateX}px, ${translateY}px) rotateZ(${rotationZ}deg) scale(${scaleFactor})`;
            }

            function handleMonthClick(event) {
                const clickedMonth = event.currentTarget;

                if (zoomedMonthElement) {
                    if (clickedMonth === zoomedMonthElement) {
                        zoomOutMonth();
                    } else {
                        zoomOutMonth();
                        setTimeout(() => zoomInMonth(clickedMonth), 550);
                    }
                } else {
                    zoomInMonth(clickedMonth);
                }
            }

            function zoomInMonth(monthElement) {
                originalYearContainerState = {
                    translateX: translateX,
                    translateY: translateY,
                    scaleFactor: scaleFactor,
                    rotationZ: rotationZ
                };

                originalMonthParent = monthElement.parentNode;
                originalMonthNextSibling = monthElement.nextSibling;
                
                calendarMonthOverlay.classList.add('show');
                calendarContentContainer.classList.add('blurred-background');

                document.body.appendChild(monthElement); // Append to body to handle fixed positioning correctly
                monthElement.classList.add('month-modal-active');
                zoomedMonthElement = monthElement;

                const monthRect = monthElement.getBoundingClientRect();
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;

                const targetPercentage = 0.9;
                const newScaleFactorX = (viewportWidth * targetPercentage) / monthRect.width;
                const newScaleFactorY = (viewportHeight * targetPercentage) / monthRect.height;
                const newScaleFactor = Math.min(newScaleFactorX, newScaleFactorY);

                monthElement.style.transform = `translate(-50%, -50%) scale(${newScaleFactor})`;
            }

            function zoomOutMonth() {
                if (!zoomedMonthElement) return;

                calendarMonthOverlay.classList.remove('show');
                calendarContentContainer.classList.remove('blurred-background');

                zoomedMonthElement.classList.remove('month-modal-active');

                if (originalMonthNextSibling) {
                    originalMonthParent.insertBefore(zoomedMonthElement, originalMonthNextSibling);
                } else {
                    originalMonthParent.appendChild(zoomedMonthElement);
                }

                zoomedMonthElement.style.transform = '';

                translateX = originalYearContainerState.translateX;
                translateY = originalYearContainerState.translateY;
                scaleFactor = originalYearContainerState.scaleFactor;
                rotationZ = originalYearContainerState.rotationZ;
                
                calendarContentContainer.style.transition = 'transform 0.5s ease-in-out';
                applyTransformations();

                zoomedMonthElement = null;
            }

            calendarMonthOverlay.addEventListener('click', () => {
                if (zoomedMonthElement) {
                    zoomOutMonth();
                }
            });

            closeCalendarModalButton.addEventListener('click', () => {
                if (zoomedMonthElement) {
                    zoomOutMonth();
                    setTimeout(() => {
                        window.hideModal('calendarModalOverlay');
                    }, 550); // Delay hiding the main modal until month zoom-out animation finishes
                } else {
                    window.hideModal('calendarModalOverlay');
                }
            });

            prevYearBtn.addEventListener('click', () => {
                if (zoomedMonthElement) return;
                currentYear--;
                renderYear();
            });

            nextYearBtn.addEventListener('click', () => {
                if (zoomedMonthElement) return;
                currentYear++;
                renderYear();
            });

            zoomInBtn.addEventListener('click', () => {
                if (zoomedMonthElement) return;
                scaleFactor = Math.min(scaleFactor + 0.1, 2.0);
                applyTransformations();
            });

            zoomOutBtn.addEventListener('click', () => {
                if (zoomedMonthElement) return;
                scaleFactor = Math.max(scaleFactor - 0.1, 0.2);
                applyTransformations();
            });

            resetViewBtn.addEventListener('click', () => {
                if (zoomedMonthElement) {
                    zoomOutMonth();
                    setTimeout(() => {
                        rotationZ = 0;
                        scaleFactor = 0.75; // Reset to the new default smaller scale
                        translateX = 0;
                        translateY = 0;
                        calendarContentContainer.style.transition = 'transform 0.5s ease-out';
                        applyTransformations();
                    }, 600);
                } else {
                    rotationZ = 0;
                    scaleFactor = 0.75; // Reset to the new default smaller scale
                    translateX = 0;
                    translateY = 0;
                    calendarContentContainer.style.transition = 'transform 0.5s ease-out';
                    applyTransformations();
                }
            });

            calendarContentContainer.addEventListener('mousedown', (e) => {
                if (zoomedMonthElement) return;
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                lastX = e.clientX;
                lastY = e.clientY;
                lastTime = Date.now();
                startRotationZ = rotationZ;
                startTranslateX = translateX;
                startTranslateY = translateY;
                velocityX = 0;
                velocityY = 0;
                velocityZ = 0;
                calendarContentContainer.style.transition = 'none';
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging || zoomedMonthElement) return;
                const currentTime = Date.now();
                const deltaX = e.clientX - lastX;
                const deltaY = e.clientY - lastY;
                const deltaTime = currentTime - lastTime;

                // Update velocities for inertia
                if (deltaTime > 0) {
                    velocityX = deltaX / deltaTime;
                    velocityY = deltaY / deltaTime;
                }

                translateX += deltaX / scaleFactor;
                translateY += deltaY / scaleFactor;

                lastX = e.clientX;
                lastY = e.clientY;
                lastTime = currentTime;

                applyTransformations();
            });

            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    // Start inertia animation
                    animationFrameId = requestAnimationFrame(animateInertia);
                }
            });

            // Touch events for mobile dragging/rotation
            calendarContentContainer.addEventListener('touchstart', (e) => {
                if (zoomedMonthElement) return;
                isDragging = true;
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                lastX = e.touches[0].clientX;
                lastY = e.touches[0].clientY;
                lastTime = Date.now();
                startRotationZ = rotationZ;
                startTranslateX = translateX;
                startTranslateY = translateY;
                velocityX = 0;
                velocityY = 0;
                velocityZ = 0;
                calendarContentContainer.style.transition = 'none';
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
            }, { passive: false }); // Use passive: false to allow preventDefault

            calendarContentContainer.addEventListener('touchmove', (e) => {
                if (!isDragging || zoomedMonthElement) return;
                e.preventDefault(); // Prevent scrolling the page
                const currentTime = Date.now();
                const deltaX = e.touches[0].clientX - lastX;
                const deltaY = e.touches[0].clientY - lastY;
                const deltaTime = currentTime - lastTime;

                if (deltaTime > 0) {
                    velocityX = deltaX / deltaTime;
                    velocityY = deltaY / deltaTime;
                }

                translateX += deltaX / scaleFactor;
                translateY += deltaY / scaleFactor;

                lastX = e.touches[0].clientX;
                lastY = e.touches[0].clientY;
                lastTime = currentTime;

                applyTransformations();
            }, { passive: false });

            calendarContentContainer.addEventListener('touchend', () => {
                if (isDragging) {
                    isDragging = false;
                    animationFrameId = requestAnimationFrame(animateInertia);
                }
            });

            // Wheel event for zoom
            calendarContentContainer.addEventListener('wheel', (e) => {
                if (zoomedMonthElement) return;
                e.preventDefault();
                const scaleAmount = e.deltaY * -0.001; // Adjust sensitivity
                scaleFactor = Math.max(0.2, Math.min(2.0, scaleFactor + scaleAmount));
                applyTransformations();
            });

            function animateInertia() {
                if (Math.abs(velocityX) > 0.01 || Math.abs(velocityY) > 0.01 || Math.abs(velocityZ) > 0.01) {
                    translateX += velocityX * 16; // Multiply by a factor for smoother deceleration
                    translateY += velocityY * 16;
                    rotationZ += velocityZ * 16;

                    velocityX *= 0.95; // Friction
                    velocityY *= 0.95;
                    velocityZ *= 0.95;

                    applyTransformations();
                    animationFrameId = requestAnimationFrame(animateInertia);
                } else {
                    cancelAnimationFrame(animationFrameId);
                }
            }

            renderYear(); // Initial render of the calendar
        }

        window.openCalendarModal = function() {
            window.showModal('calendarModalOverlay');
            initializeCalendar(); // Initialize calendar logic when modal is opened
        };

        // =====================================================================
        // INICIALIZACIÓN DE LA APLICACIÓN
        // =====================================================================
        // Asegurar que el DOM esté completamente cargado antes de inicializar la aplicación
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeFirebase(); // Inicializar Firebase y cargar ajustes de la app
            setupModalOverlayListeners(); // Configurar listeners para cerrar modales al hacer clic fuera
            setupDockAnimations(); // Configurar animaciones y comportamiento del dock
        });
    </script>
</body>
</html>
